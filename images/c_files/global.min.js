(function(){$("#experience").css({opacity:"0"})}());$(window).load(function(){$("#experience").css({opacity:"1"});setTimeout(function(){$("#loader-box").fadeOut("slow")},1000)});function callback(){setTimeout(function(){$("#effect").removeAttr("style").hide().fadeIn()},1000)}function isLocalStorageNameSupported(){var c="test",b=window.sessionStorage;try{b.setItem(c,"1");b.removeItem(c);return true}catch(a){return false}}if(!isLocalStorageNameSupported()){$("body.jshide #systemMessaging").css("display","block");$(".OverlayWrapper").hide();if(navigator.userAgent.match(/(iPad);.*CPU.*OS 7_\d/i)){$("#ipadMsg").show()}if((navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Mac")!=-1&&navigator.userAgent.indexOf("Chrome")==-1)&&!navigator.userAgent.match(/(iPad);.*CPU.*OS 7_\d/i)){$("#safariMacMsg").show()}}(function(){var c;var e=function(){};var d=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"];var b=d.length;var a=(window.console=window.console||{});while(b--){c=d[b];if(!a[c]){a[c]=e}}}());function GetAssetRoot(){return global.VARS.assetroot}function GetAssetPath(a){return GetAssetRoot()+a}function isFlashSoundsEnabled(){return true}function isHTMLSoundsEnabled(){return true}function isDebug(){return false}function canLogConsole(){return false}function Log(a){}var soundplayer={lastSoundPlayed:"",lastAtmosphericSound:"",lowQuality:false,ready:false,sounds:{},ids:{},loop_tracker:{},sound_control_added:false,soundbite_playing:false,soundbite_position:null,soundbite_id:"",atmospherical_sounds:{},low_quality_sounds:{},created_sounds:[],unmute:function(){soundManager.unmute();for(var a=0;a<this.created_sounds.length;a++){var b=this.created_sounds[a];this.createSound(b.obj,b.atmospherical,b.play_in_low_quality)}this.created_sounds=[];if($.browser.touchdevice){if(this.lastAtmosphericSound){this.play(this.lastAtmosphericSound)}if(this.soundbite_id){this.resume(this.soundbite_id)}}this.quality(this.lowQuality)},mute:function(a){if($.browser.touchdevice){if(this.lastAtmosphericSound){this.stop(this.lastAtmosphericSound);this.currentAtmosPlaying=null}if(this.soundbite_id){this.pause(this.soundbite_id)}}soundManager.mute(a)},fadeto:function(g,n,e,h){if(soundManager.muted){if(n==0){this.stop(g)}else{this.play(g)}return false}if(!e){e=1000}if(!h){h=5}if(h<1){h=1}var a=this;var k=soundManager.getSoundById(this.getid(g));if(typeof k==="undefined"){setTimeout(function(){a.fadeto(g,n,e,h)},200);return false}if(k.playState===0){this.play(g)}var c=k.volume;var d=n-c;if(d!==0){var l=Math.abs(d/h);var j=e/l;var o=d/l;var b=0;var f=function(){b++;if(b<l){soundplayer.setVolume(g,k.volume+o);setTimeout(f,j)}else{if(n===0){soundplayer.stop(g)}}};setTimeout(f,j)}},createSound:function(d,a,f){var g=this;if(soundManager.muted){this.created_sounds.push({obj:d,atmospherical:a,play_in_low_quality:f});return false}if(!d){return false}if(!d.url){return false}if(this.lastAtmosphericSound){if(d.id.indexOf("atmospheric")>-1){if(this.lastAtmosphericSound===d.id){d.onload=function(){soundplayer.play(soundplayer.lastAtmosphericSound)};this.initiOS(this.lastAtmosphericSound)}else{d.onload=null}}}if(typeof d.url==="string"){d.url=[d.url]}var c=String(d.url[0]).replace(/(.ogg|.mp3|.m4a)/,"");if($.browser.IE){for(var b in d.url){d.url[b]+="?s="+new Date().getTime()}}if(a){this.atmospherical_sounds[d.id]=true}else{if(d.loops>1){var e=d.onfinish;this.loop_tracker[d.id]={count:0,loops:d.loops};d.onfinish=function(){g.loop_tracker[d.id].count++;if(g.loop_tracker[d.id].count<g.loop_tracker[d.id].loops){soundplayer.play(d.id)}else{g.loop_tracker[d.id].count=0;if(e){e()}}};d.loops=1}}this.low_quality_sounds[d.id]=f;if(!this.sounds[c]){this.sounds[c]=d.id;this.ids[d.id]=d.id;soundManager.createSound(d)}else{this.sounds[d.id]=true;this.ids[d.id]=this.sounds[c]}},initiOS:function(a){if($.browser.touchdevice){if(a.indexOf("atmospherics")>=0){return false}var b=($("canvas#canvas").length>0)?$("canvas#canvas"):$(document);b.bind("touchend.iphone",function(c){b.unbind("touchend.iphone");soundplayer.play(a)})}},quality:function(b){this.lowQuality=b;if(this.lowQuality){this.currentAtmosPlaying=null;this.stop(this.lastAtmosphericSound);for(var a in this.atmospherical_sounds){this.stop(a)}}else{this.play(this.lastAtmosphericSound);for(var a in this.atmospherical_sounds){this.play(a)}}},getid:function(a){if(typeof a==="object"){a=$(a).attr("id")}if(this.ids[a]){a=this.ids[a]}return a},setVolume:function(a,b){a=this.getid(a);soundManager.setVolume(a,b)},setPan:function(a,b){soundManager.setPan(this.getid(a),b)},count:0,currentAtmosPlaying:null,play:function(f,j){var a=this;if(this.currentAtmosPlaying===f){return false}else{this.currentAtmosPlaying=null}if(f==="atmospherics"){this.currentAtmosPlaying=f}if(!isHTMLSoundsEnabled()||!f){return false}f=this.getid(f);if(!j){j={}}$.each(soundManager.sounds,function(o,n){if(n.id===f){$.extend(j,n.options)}});var g=false;var h=f.indexOf("soundbite")>-1;if(f.indexOf("atmospheric")>-1){if($.browser.touchdevice){return false}g=true;this.lastAtmosphericSound=f;var b=j.onfinish;if($.browser.ipad||$.browser.iphone){$.each(soundManager.sounds,function(o,n){if(n.id===f){n.options.onfinish=function(){a.currentAtmosPlaying=null;if(b){b()}if(!$.browser.iOS){soundplayer.play(soundplayer.lastAtmosphericSound)}}}})}else{j.onfinish=function(){a.currentAtmosPlaying=null;if(b){b()}if(!$.browser.iOS){soundplayer.play(soundplayer.lastAtmosphericSound)}}}}var d;if(h){$.each(soundManager.sounds,function(o,n){if(n.id===f){d=n.options.onfinish}});j.onfinish=function(){if(d){d()}soundplayer.soundbite_id="";soundplayer.soundbite_playing=false}}if(soundManager.muted){return false}if($.browser.ipad||$.browser.iphone){if(!g){var l=this;var c=j.onfinish;$.each(soundManager.sounds,function(o,n){if(n.id===f){n.options.onfinish=function(){if(h){soundplayer.soundbite_id="";soundplayer.soundbite_playing=false}if(c){c()}else{if(l.lastAtmosphericSound){soundManager.play(l.lastAtmosphericSound)}}}}})}}else{var e=j.onfinish;j.onfinish=function(){if(e){e()}}}if(this.lowQuality&&this.low_quality_sounds[f]===false){return false}if((this.lowQuality&&g)||!this.ready||(this.lowQuality&&this.atmospherical_sounds[f])){return false}if((this.soundbite_playing)&&($.browser.ipad||$.browser.iphone||$.browser.android)){return false}if(h){this.soundbite_playing=true;this.soundbite_id=f}var k=soundManager.play(f,j);return true},stop:function(a){if(!isHTMLSoundsEnabled()||!this.ready){return false}var b=a.indexOf("soundbite")>-1;if(b){this.soundbite_playing=false;this.soundbite_id=""}soundManager.stop(a);return true},pause:function(a){if(!isHTMLSoundsEnabled()||!this.ready){return false}var b=a.indexOf("soundbite")>-1;if(b){this.soundbite_playing=false;this.soundbite_position=soundManager.getSoundById(a).position}var c=soundManager.stop(a);return true},resume:function(a){if(!isHTMLSoundsEnabled()||!this.ready){return false}var b=a.indexOf("soundbite")>-1;var c={};if(b){c={position:this.soundbite_position}}soundManager.setPosition(a,this.soundbite_position);var d=soundManager.play(a);soundManager.setPosition(a,this.soundbite_position);if(b){this.soundbite_playing=true}return true},addSound:function(e,a,b,d){var c=$("a#"+e+", li#"+e+" a");if(canLogConsole()){}if(!c.length){return}if(b==null){b="common/item-collect.mp3"}if(d==null){d="common/item-rollover.mp3"}if(a){a=GetAssetPath("html5/audio/"+a)}else{a=""}c.attr("data-click-audio",a);c.attr("data-hover-audio",GetAssetPath("html5/audio/"+d));if(b!=""){c.attr("data-collect-audio",GetAssetPath("html5/audio/"+b))}},getAudioFileArray:function(a){var b=a.split(".");b.pop();var c=b.join(".");return[c+".ogg",c+".mp3",c+".m4a"]},init:function(){AddSoundControl(null,true);$("a[data-hover-audio], a[data-click-audio], a[data-collect-audio]").each(function(){var c=$(this).attr("id");if(!c){c=$(this).parent().attr("id")}var a=$(this).attr("data-click-audio");if(a){soundplayer.createSound({id:c+"_click",url:soundplayer.getAudioFileArray(a),loops:1,autoLoad:true,multiShot:false,onload:function(){}});$(this).bind("click touchstart",function(e){var f=c+"_click";if(soundOn()){soundplayer.play(f)}})}var d=$(this).attr("data-hover-audio");if(d){soundplayer.createSound({id:c+"_hover",url:soundplayer.getAudioFileArray(d),loops:1,autoLoad:true,multiShot:false});$(this).bind("mouseover",function(){var e=c+"_hover";if(soundOn()){soundplayer.play(e)}})}var b=$(this).attr("data-collect-audio");if(b){soundplayer.createSound({id:c+"_collect",url:soundplayer.getAudioFileArray(b),loops:1,autoLoad:true,multiShot:false})}})}};var global={DEBUG:true,VARS:{assetroot:$("script#globalJs").attr("src").split("redesign/js/")[0],assetrootredesign:$("script#globalJs").attr("src").split("js/")[0],lang:String($("html").attr("lang")).toLowerCase(),WebVPN:false},init:function(a){this._getQueryVariables();this.refresh(a);this.VARS.WebVPN=(this.VARS.assetroot.indexOf("/+CSCO")>=0);return this},refresh:function(a){this.initRatings(a)},initRatings:function(a){if(!a){a=document}},perfMode:(/android/.test(navigator.userAgent.toLowerCase()))?true:false,_getQueryVariables:function(){var b=this;b.VARS.assetroot=$("script#globalJs").attr("src").split("redesign/js/")[0];b.VARS.assetrootredesign=$("script#globalJs").attr("src").split("js/")[0];var a=$("script").each(function(d){var c=$(this);if(c.attr("src")){var j=c.attr("src");var h=j.replace(/^[^\?]+\??/,"");var g=h.split(/[;&]/);for(var d=0;d<g.length;d++){var f=g[d].split("=");if(!f||f.length!=2){continue}var e=unescape(f[0]);var k=unescape(f[1]);k=k.replace(/\+/g," ");b.VARS[e]=k}}})},initAjaxDefaults:function(){$.ajaxSetup({cache:false,beforeSend:function(a){},complete:function(a){if(this.url!=undefined){if(this.url.indexOf(".js")===-1){analytics.page(this.url,ajaxAnalytics)}}},success:function(a){if(a){if(a.status===0){window.location.reload()}}},error:function(b,a){if(b.status===0){window.location.reload()}else{if(b.status===404){window.location=UrlResource.error404}else{if(b.status===500){window.location=UrlResource.error500}else{if(b.status===503){window.location=this.url.split("?")[0]}else{if(a==="parsererror"){}else{if(a==="timeout"){window.location.reload()}else{window.location.reload()}}}}}}}});return this}};soundManager.setup({url:GetAssetPath("media/"),flashVersion:9,useFlashBlock:false,allowScriptAccess:"always",debugFlash:false,debugMode:false,onready:function(){},ontimeout:function(){}});soundManager.onready(function(a){soundplayer.ready=true});function soundOn(){if($.cookie("sound")===null){return true}else{if(Number($.cookie("sound"))===1){return true}else{return false}}}function AddSoundControl(a,d){var c=$("#sound-control").length>0;if(c){return false}if((d&&!isHTMLSoundsEnabled())||(!d&&!isFlashSoundsEnabled())){return false}var b=$("#flash-controls").length>0;if(!b){$("#footholder").append('<div id="flash-controls"><ul></ul></div>')}var f;if($.cookie("sound")===null){f=1;$.cookie("sound",1,{path:"/"})}else{f=Number($.cookie("sound"))}var e=LanguageResource.soundMute;var g=LanguageResource.soundUnMute;$("#flash-controls ul").prepend('<li><a href="#" id="sound-control">'+(f?e:g)+"</a></li>");if(f===1){$("#sound-control").addClass("enabled")}if(d&&f!=1){soundplayer.mute();if(typeof(ig)==="object"){}}$("#sound-control").click(function(h){h.preventDefault();f=f===1?0:1;$.cookie("sound",f,{path:"/"});if(f){$("#sound-control").addClass("enabled")}else{$("#sound-control").removeClass("enabled")}$(this).text(f?e:g);if(d){if(f===1){if(soundplayer){soundplayer.unmute()}if(typeof(ig)==="object"){ig.music.setVolume(1);ig.soundManager.volume=0.5}}else{soundplayer.mute();if(typeof(ig)==="object"){ig.music.setVolume(0);ig.soundManager.volume=0}}}if(a){a(f)}})}$.browser.chrome=($.browser.webkit&&/chrome/.test(navigator.userAgent.toLowerCase()))?true:false;$.browser.safari=($.browser.webkit&&!$.browser.chrome&&/safari/.test(navigator.userAgent.toLowerCase()))?true:false;$.browser.ipad=($.browser.safari&&/ipad/.test(navigator.userAgent.toLowerCase()))?true:false;$.browser.iphone=($.browser.safari&&/iphone/.test(navigator.userAgent.toLowerCase()))?true:false;$.browser.android=(/android/.test(navigator.userAgent.toLowerCase()))?true:false;$.browser.touchdevice=$.browser.ipad||$.browser.iphone||$.browser.android;$.browser.iOS=$.browser.ipad||$.browser.iphone;$.browser.IE=$.browser.msie;var _is_canvas_supported=null;var canvasSupport;function is_canvas_supported(){if(_is_canvas_supported!=null){return _is_canvas_supported}try{_is_canvas_supported=!!(document.createElement("canvas").getContext("2d"))}catch(a){try{_is_canvas_supported=!!(document.createElement("canvas").getContext)}catch(a){_is_canvas_supported=false}}if(!_is_canvas_supported){$("body").addClass("noCanvasSupport")}else{$("body").addClass("canvasSupport");canvasSupport=true}return _is_canvas_supported}(function(a){var b=a.ajax;a.extend({ajax:function(c){var e=c.url;if(e&&e!=undefined){if(e.indexOf("#")>0){if(e.indexOf("?")>0){var d=e.split("?")[1];e=e.split("#")[0]+"?"+d}else{e=e.split("#")[0]}}if(e.indexOf("?")>0){e=e+"&ajax=ajax"}else{e=e+"?ajax=ajax"}c.url=e;return b.call(this,c)}}})}(jQuery));var curvyCornersVerbose=false;$.fn.floodLoadImg=function(){return this.each(function(){$("<img/>")[0].src=$(this).attr("title").replace("ord=1","ord="+((Math.random()+"")*10000000000000))})};$.fn.commenting=function(){return this.each(function(){var a=$(this).parents("form");var c=false;var b=a.find("input[type='submit']");a.submit(function(){if(!c){c=true;b.addClass("disabled").attr("disabled","disabled");spinner.init({elem:a.find(".ctabutton").parent(),top:0,left:0,bottom:0,size:"mini",color:"#fff"})}})})};function create_youtube_video(f,j,c,d,b){$("#close,#jquery-overlay,#videoplayer").live("click",function(h){h.preventDefault();$.LightboxModal.fadeOut(1000);$("#videoplayer").hide().remove();if(d){if(d.kill){d.kill()}}});var g=f+"?version=3&rel=0&autoplay=1&modestbranding=1&html5=1";var e="//www.youtube.com/embed/"+g;$.LightboxModal.fadeIn(1000);if($.browser.msie&&$.browser.version===9){var a=$('<div id="videoplayer" class="message '+b+'"><a href="#'+LanguageResource.uiClose.toLowerCase()+'" id="close" alt="'+LanguageResource.uiClose+'">'+LanguageResource.uiClose+'</a><object style="height: '+c+"px; width: "+j+'px"><param name="movie" value="http://www.youtube.com/v/'+g+'"><param name="allowFullScreen" value="true"><param name="allowScriptAccess" value="always"><embed src="http://www.youtube.com/v/'+g+'" type="application/x-shockwave-flash" allowfullscreen="true" allowScriptAccess="always" width="762" height="448"></object></div>')}else{var a=$('<div id="videoplayer" class="message '+b+'"><a href="#'+LanguageResource.uiClose.toLowerCase()+'" id="close" alt="'+LanguageResource.uiClose+'">'+LanguageResource.uiClose+'</a><iframe title="" width="'+j+'" height="'+c+'" src="'+e+'" frameborder="0" allowfullscreen="false"></iframe></div>')}$("body").append(a);$("#close").focus()}var feedbackOn=false;var markupOn=false;var feedback={clicked:function(a){a.preventDefault();if(feedbackOn!=true){feedbackOn=true;$.LightboxModal.fadeIn(1000);if($("body").hasClass("game")||$("body").hasClass("potion-game")){$("#game-wrapper").hide()}feedback.removeOtherOverlays().addMarkup($(this)).closeFeedback()}},removeOtherOverlays:function(){$("#overwrap").remove();$(window).unbind("resize",self.windowResize);return this},iframeLoaded:function(){spinner.killSpinner();$("#feedbackpanel .jspContainer .jspVerticalBar .jspTrack .jspDrag").add("#feedbackpanel .jspPane").css("top",0)},addMarkup:function(c){var d=c.attr("href");var b=c.html();if(markupOn!=true){markupOn=true;var e=$('<div id="fwrap"><div id="brdr"><div class="hdr"><span class="bf">'+b+'</span></div><a href="#" class="closebtn">'+LanguageResource.uiClose+'</a><div id="feedbackpanel"></div></div></div>');var a=$('<iframe onload="feedback.iframeLoaded()" id="sm" src="'+d+'" width="739px" height="1300px" scrolling="no"></iframe>');$("body").append(e);$("#fwrap").css({top:$(window).scrollTop()+50+"px"});spinner.init({elem:$("#brdr"),top:-130,left:-12,bottom:-2,size:"largeadjustable",color:"#000"});$("#feedbackpanel").append(a).jScrollPane({showArrows:true,hijackInternalLinks:true})}return this},closeFeedback:function(){$("#jquery-overlay,#brdr .closebtn").click(function(a){a.preventDefault();feedback.fadeAway()})},fadeAway:function(){feedbackOn=false;markupOn=false;$("#fwrap").remove();$.LightboxModal.fadeOut(0);if($("body").hasClass("game")||$("body").hasClass("potion-game")){$("#game-wrapper").show()}}};$.fn.showFeedback=function(){return this.each(function(){$(this).click(feedback.clicked)})};if(typeof(soundManager)==="object"){}$.fn.initJPlayer=function(){var b=this;if($(".audioMultiple").length){var a=$(".audioMultiple")}else{var a=b.find(".section")}if(a.find(".audioPlayerAvailable").length){$(".audioPlayerAvailable").show()}if($.browser.iOS){$(".jsplayer").addClass("iOS")}else{if($.browser.android){$(".jsplayer").addClass("android")}}$.each(a,function(e,d){$(d).find(".jp-jplayer").jPlayer({ready:function(){$(d).find(".jp-jplayer").jPlayer("setMedia",{mp3:GetAssetPath("media/audio-player/"+$(d).find(".jsplayer").attr("data-filename")+".mp3"),m4a:GetAssetPath("media/audio-player/"+$(d).find(".jsplayer").attr("data-filename")+".m4a"),oga:GetAssetPath("media/audio-player/"+$(d).find(".jsplayer").attr("data-filename")+".ogg")})},swfPath:GetAssetPath("js/third-party/Jplayer.swf"),cssSelectorAncestor:"#"+$(d).find(".jp-audio").attr("id"),supplied:"mp3, m4a, oga",errorAlerts:false,solution:"flash, html",preload:"auto",loadeddata:function(){if($.browser.iOS||$.browser.android){$(".jp-duration").show()}}});var h=false;var k=false;var j,g,f,c,l;if($.browser.iOS||$.browser.android){}$(d).find(".jp-progress").mousedown(function(n){n.preventDefault();c=$(this);if(!a.find(".jp-jplayer").data("jPlayer").status.paused&&a.find(".jp-jplayer").jPlayer("pause")){l=true}h=true;j=n.layerX;c.find(".jp-variable").width(j);width=parseInt($(this).css("width"),10)});$(d).find(".jp-volume").mousedown(function(n){n.preventDefault();c=$(this);k=true;j=n.layerX;c.find(".jp-variable").width(j);width=parseInt($(this).css("width"),10)});$(document).mousemove(function(n){if(h||k){g=(n.clientX-c.offset().left);if(g<0){g=0}if(g>width){g=width}c.find(".jp-variable").width(g)}if(h){$(d).find(".jp-jplayer").jPlayer("playHead",(100/width*g))}}).mouseup(function(n){if(h){g=(n.clientX-c.offset().left);$(d).find(".jp-jplayer").jPlayer("playHead",(100/width*g));if(l){$(d).find(".jp-jplayer").jPlayer("play");l=false}h=false}if(k){g=(n.clientX-c.offset().left);$(d).find(".jp-jplayer").jPlayer("volume",(1/width*g));if(l){$(d).find(".jp-jplayer").jPlayer("play");l=false}k=false}})})};$.focusFirstField=function(){setTimeout(function(){if($(".input-validation-error").length>0){$(".input-validation-error:first").focus()}else{$("form .row:first").find("input:first,a.jsdd-display:first,textarea:first").focus()}},50)};$.lazyLoadObj=function(a){var c=[];var b=[];var d=global.VARS.assetroot;$(a).each(function(){var k=this;var f={objectName:"",fileName:"",filePath:"js/load/",rootPath:d,checkElement:"",autoRun:false};$.extend(f,k);if($(f.checkElement).length>0||f.autoRun){var h="";try{h=window[f.objectName];h.init()}catch(g){var j=(f.fileName==="")?f.objectName:f.fileName;if($.inArray(j,c)!=-1){b[$.inArray(j,c)].push(f.objectName)}else{c.push(j);b[$.inArray(j,c)]=[f.objectName];$.ajax({url:f.rootPath+f.filePath+j+".min.js",dataType:"script",cache:true,success:function(){if(b[$.inArray(j,c)].length>1){var e=b[$.inArray(j,c)];var l=e.length;while(l--){h=window[e[l]];h.init()}}else{h=window[f.objectName];h.init()}}})}}}})};var components={init:function(){this.starRatings();this.likes()},likes:function(){$(".like-panel").find("button").live("click",function(c){c.preventDefault();var b=$(this);b.addClass("miniSpinner");if($.browser.webkit){spinner.init({elem:b,top:3,left:-3,size:"mini"})}else{spinner.init({elem:b,top:1,left:-3,size:"mini"})}var f=b.parents("form").attr("action");var a=b.parents("form");var d=b.parents(".minioverlay.illustrations").length>0;$.ajax({type:"POST",url:f,data:a.serialize(),success:function(e){spinner.killSpinner();a.parents(".like-panel").replaceWith(e);$.redrawCorners();if(d){components.updateIllustrationPanel()}}})})},updateIllustrationPanel:function(){if($(".panel.illustrations").length>0){var a=$(".panel.illustrations");var b;if($("#overview").length>0){b=a.find("a.ctaanc").attr("href")}else{b=a.find("a.more-link").attr("href")}$.ajax({type:"GET",url:b,cache:false,success:function(e){var c=$(e);var d=c.find("ul:eq(0)");if($("#overview").length>0){d.find("li:gt(0)").remove()}else{d.find("li:gt(2)").remove()}a.find("ul:eq(0)").replaceWith(d)}})}},starRatings:function(){try{$("select.rating").rating({callback:function(h,d){var e=$(d).parents("div.rating-panel");var b=$(d).parents(".rating-panel").find("form").serialize();var g=$(d).parents(".rating-panel").find("form").attr("action");var f=function(j,k,l){if(j.Status===true||true){e.find("span.count").html(j.RatingCount);e.find(".btn").removeClass("cancelled").attr("value",LanguageResource.uiRateAdjust);e.find("dt,dd").toggleClass("hide");e.find("dd.rating").attr("class","rating r-"+(Number(j.RatingAvgRounded)*10))}else{}};var c="json";$.ajax({type:"POST",url:g,data:b,success:f,dataType:c});return false}}).parent().find("span.cta").addClass("hide")}catch(a){console.error(a)}return this}};var olddock={init:function(){frames.init();$("#usr").find(".earned a").ellipses(17);$("#usr").find(".earned a").find(".hearned a").ellipses(13);var a=!$("body").hasClass("potion-game");this.dropdown().animations(a).wings()},wings:function(){var e=$("#points");var g=$("#upoints .points");var d=$("#hpoints .points");var f=$("#upoints .lbl");var c=$("#hpoints .lbl");var b=d.add(g);var a=c.add(f);var p=$("#upoints .lbl a").text().length;var o=g.width();var j=d.width();var n=f.width();var h=c.width();var l=o;var k=n;if(o!==j){l=Math.max(o,j)}if(n!==h){k=Math.max(n,h)}if($.browser.msie&&k>200){k+=5}if(l+k>320&&!e.hasClass("mini")){e.addClass("mini");this.wings()}else{if(p>18&&($("html").attr("lang")==="fr"||$("html").attr("lang")==="de")){k+=30}b.width(l);a.width(k)}return this},dropdown:function(){var a=$("#dropdown");a.addClass("enhance closed").find("h2").tooltip({parentElm:a,showEvent:"click",element:a.find("ul"),hideTime:600,alternate:false,nextElem:true},function(){a.addClass("closed")}).click(function(){a.removeClass("closed")}).find("a").click(function(b){b.preventDefault()});a.find("a").bind("focus",function(){$(this).addClass("infocus");if(a.hasClass("closed")){a.find("h2").trigger("click")}}).bind("focusout",function(){$(this).removeClass("infocus");setTimeout(function(){if(a.find("a.infocus").length===0){a.addClass("closed").find("ul").hide()}},600)});return this},animations:function(a){var b=[];if(a){$("#dock li.anim a, #dock li.anim span.locked").each(function(){if($("#experience").length){return false}var c=$(this);var o=c.text();var e=c.attr("id");var l=c.attr("src");var g=c.find("img").attr("src");var j=g;c.html("");var n=Raphael(e,86,70);var h=($.browser.msie)?66:67;var f=n.image(j,0,0,h,70);b.push(f);var k=false;$(this).focus(function(p){k=f;d(f)});f.mouseover(d);function d(p){var r=(k)?k:this;var q=p.pageX-c.offset().left>c.width()/2;if(q){r.stop().animate({"15%":{rotation:"10 33 7",easing:"linear"},"45%":{rotation:"-6 33 7",easing:"linear"},"70%":{rotation:"4 33 7",easing:"linear"},"90%":{rotation:"-2 33 7",easing:"linear"},"100%":{rotation:"0 33 7",easing:"linear"}},1000)}else{r.stop().animate({"15%":{rotation:"-10 33 7",easing:"linear"},"45%":{rotation:"6 33 7",easing:"linear"},"70%":{rotation:"-4 33 7",easing:"linear"},"90%":{rotation:"2 33 7",easing:"linear"},"100%":{rotation:"0 33 7",easing:"linear"}},1000)}}})}$.fn.changeDockIcon=function(f,e){var d=b[f];var c=d.attr();var g=(e)?"here/":"";var h=c.src.replace("locked/",g);c.src=h;d.attr(c)};return this}};var frames={parent:"#owlwrap",images:"",position:0,timings:[300,66,33,1000,1166,266,500],animating:false,init:function(){var b=frameorder.length-1;var a=$(this.parent);var d=global.VARS.assetroot+"media/dock/owl/";while(b--){var c=$('<img src="'+d+frameorder[b].image+'.png" />').data("timeout",frames.timings[frameorder[b].rate]);a.prepend(c)}$("#owl").addClass("anim");this.images=a.find("img");$("#owl").bind("focus",function(){$(this).trigger("mouseover").parents("#owlwrap").addClass("hover")}).bind("focusout",function(){$(this).parents("#owlwrap").removeClass("hover")});$("#owl").bind("mouseover",frames.trigger);this.blink()},blink:function(){var a=this;setTimeout(function(){a.animate(5);a.blink()},a.calcRandomTime())},calcRandomTime:function(){return(Math.floor(Math.random()*10)+11)*1000},trigger:function(){if(frames.animating){$("#owl").unbind("mouseover",frames.trigger)}else{frames.animating=true;frames.animate()}},animate:function(b){image=frames.images.eq(frames.position);var c=(b)?b:frames.images.length-1;if(frames.position===c){frames.position=0;frames.run(image,frames.images.eq(0),false,b);return false}frames.position=(frames.position===frames.images.length-1)?0:frames.position+1;var a=frames.images.eq(frames.position);frames.run(image,a,true,b)},run:function(b,c,a,d){setTimeout(function(){b.hide();c.show();if(a){frames.animate(d)}else{frames.animating=false;$("#owl").bind("mouseover",frames.trigger)}},b.data("timeout"))}};var frameorder=[{image:4,rate:0},{image:3,rate:1},{image:2,rate:1},{image:1,rate:2},{image:2,rate:2},{image:3,rate:2},{image:4,rate:3},{image:3,rate:1},{image:5,rate:1},{image:6,rate:2},{image:7,rate:2},{image:8,rate:2},{image:9,rate:1},{image:10,rate:1},{image:11,rate:4},{image:12,rate:1},{image:13,rate:1},{image:14,rate:2},{image:13,rate:2},{image:12,rate:2},{image:11,rate:5},{image:10,rate:1},{image:9,rate:1},{image:8,rate:2},{image:7,rate:2},{image:6,rate:2},{image:5,rate:1},{image:3,rate:1},{image:4,rate:6}];var spinner={init:function(b){this.kill=false;var d=this;var a=$("<div id='spinner'>&nbsp;</div>");if($("#spinner").length){$("#spinner").remove()}if(typeof b.css==="undefined"){a.css({"margin-top":b.top+"px","margin-left":b.left+"px"})}else{a.css(b.css)}$(b.elem).append(a);if(b.size==="large"){a.css({"margin-left":"auto","margin-right":"auto",position:"relative","float":"none"});var c=d.spinner("spinner",12,18,24,2,(b.color)?b.color:"#fff")}else{if(b.size==="largeadjustable"){a.css({"margin-left":"auto","margin-right":"auto",left:b.left+"px",top:b.top+"px","margin-bottom":b.bottom+"px"||"0px",position:"relative","float":"none"});var c=d.spinner("spinner",12,18,24,2,(b.color)?b.color:"#fff")}else{if(b.size==="largeinline"){a.css({"margin-left":"auto","margin-right":"auto",position:"absolute","float":"none"});var c=d.spinner("spinner",12,18,24,2,(b.color)?b.color:"#fff")}else{if(b.size==="mini"){a.css({padding:"0"});var c=d.spinner("spinner",3,5,12,1,(b.color)?b.color:"#fff")}else{var c=d.spinner("spinner",6,9,12,2,(b.color)?b.color:"#fff")}}}}},killSpinner:function(){$("#spinner").remove()},killMulti:function(){$(".multispin").remove()},multi:function(e){var g=this;var d=e.length;var f=(e.hasReset>0)?e.position-e.hasReset+1:e.position;f=(f<=0)?1:f;var b=(d*f)-d;if($(".multispin").length){$(".multispin").remove()}for(var c=0;c<d;c++){if($(e.elem).eq(c+b).length!=1){return false}var a=$("<div id='spinner"+c+"' class='multispin'>&nbsp;</div>");a.css({margin:"0",padding:"0","z-index":"50",position:"absolute",top:e.top+"px",left:e.left+"px"});$(e.elem).eq(c+b).append(a);g.spinner("spinner"+c,6,9,12,2,"#fff")}},spinner:function(k,s,u,g,y,e){if($("#experience").length){return false}var w=g||12;var d=e||"#fff";var B=y||15;var q=Math.min(s,u)||35;var t=Math.max(s,u)||60;var h=t+B;var j=t+B;var p=Raphael(k,t*2+B*2,t*2+B*2);var v=[];var n=[];var c=2*Math.PI/w;var o={stroke:d,"stroke-width":B,"stroke-linecap":"round"};Raphael.getColor.reset();for(var l=0;l<w;l++){var b=c*l-Math.PI/2,f=Math.cos(b),x=Math.sin(b);n[l]=1/w*l;v[l]=p.path([["M",h+q*f,j+q*x],["L",h+t*f,j+t*x]]).attr(o)}var z;var a=this;(function A(){n.unshift(n.pop());for(var r=0;r<w;r++){v[r].attr("opacity",n[r])}p.safari();if(!a.kill){z=setTimeout(A,1000/w)}})();return function(){clearTimeout(z);p.remove()}}};var analytics={storedCategory:"",storedSubCategory:"",isEvent:false,init:function(){this.storedCategory=ajaxAnalytics.PageCategory;this.storedSubCategory=ajaxAnalytics.PageSubCategory},page:function(h){var j=document.createElement("a");j.href=h;h=j.pathname;var a="";if(ajaxAnalytics.Category==="registration"){try{a=(ajaxIsUnder13)?"under13":"over13"}catch(d){}h=h.replace("?ajax=ajax","");var c=h.charAt(h.length-1);var f=parseInt(c)+1;h=h.replace(c,f)}var b=(analytics.isEvent)?this.storedCategory:ajaxAnalytics.Category;var g=(analytics.isEvent)?this.storedSubCategory:ajaxAnalytics.SubCategory;a=(a==="")?ajaxAnalytics.global.AgeCategory:a;_gaq.push(["_setCustomVar",1,"Site-Area",b,3]);_gaq.push(["_setCustomVar",2,"Sub-Area",g,3]);_gaq.push(["_setCustomVar",3,"Language",ajaxAnalytics.global.Language,3]);_gaq.push(["_setCustomVar",4,"Sex",ajaxAnalytics.global.SexCategory,3]);_gaq.push(["_setCustomVar",5,"Age-Range",a,3]);_gaq.push(["_setDomainName",".pottermore.com"]);_gaq.push(["_trackPageview",h]);ajaxAnalytics.Category="";ajaxAnalytics.SubCategory="";analytics.isEvent=false},events:function(){var b=this;$(analyticsEvents).each(function(){if($(this.item).length>0||this.isLiveEvent&&$(this.parentCheckItem).length>0){b.pushEvent(this)}})},pushEvent:function(a){$(a.item).live("click",function(){_gaq.push(["_trackEvent",a.category,a.subcategory,a.label])})}};var analyticsEvents=[{item:".likeviafacebook",category:"social",subcategory:"facebook",label:"like"},{item:".facebookconnect input[type='submit']",category:"social",subcategory:"facebook",label:"connect"},{item:"#addressbook .user .removefriend input[type='submit']",category:"interactions",subcategory:"site",label:"remove friend",isLiveEvent:true,parentCheckItem:"#addressbook"},{item:".comments .ctabutton input[type='submit'], #commentform .ctabutton input[type='submit']",category:"interactions",subcategory:"site",label:"comment"},{item:".favourite:not('.favourite.remove') input[type='submit']",category:"interactions",subcategory:"site",label:"add to favourites",isLiveEvent:true,parentCheckItem:".favourite"},{item:".favourite.remove input[type='submit']",category:"interactions",subcategory:"site",label:"remove from favourites",isLiveEvent:true,parentCheckItem:".favourite"},{item:"#frame.diagon-alley.product input[type='submit']",category:"interactions",subcategory:"shop",label:"purchase item"},{item:"#items li a.collecttrigger",category:"interactions",subcategory:"moment",label:"item found"},{item:"#obj dl dd .ctabutton input[type='submit']",category:"interactions",subcategory:"moment",label:"item collected"},{item:"#frame #shopping-list a",category:"interactions",subcategory:"moment",label:"viewed shopping list"}];var flash={embeds:{},ready:false,init:function(){this.ready=true},add:function(f,g,b,k,c,j,l,h,e,a){a.id=a.id||g;h.fileId=g;if(typeof(b)!="function"){b=function(n){}}var d={id:g,stack:[],ready:false,hasFlash:swfobject.hasFlashPlayerVersion(j),callback:b};if(d.hasFlash){this.embeds[g]=d;swfobject.embedSWF(f,g,k,c,j,l,h,e,a)}return d},ready:function(b){var c=flash.embeds[b];if(c){if(!c.ready){c.ready=true;while(c.stack.length){var a=c.stack.shift();flash.sendto.as(b,a)}}}return flash.ready},sendto:{js:function(a,b){if(!a){}if(flash.embeds[a]){flash.embeds[a].callback(b)}else{}},as:function(b,f){if(b){if(typeof(b)==="object"){b=b.id}if(!$("#"+b).length){return}var d=flash.embeds[b];if(d){if(!d.ready){d.stack.push(f)}else{try{var c=flash.movie(b);c.sendToActionScript(f)}catch(a){}}}}}},movie:function(a){return(navigator.appName.indexOf("Microsoft")!=-1)?window[a]:document[a]},preloadSwfs:function(b){var c=$("body").prepend('<div id="flashloader"><div id="flashmoviepreload"></div></div>');$("#flashloader").css({position:"absolute"});var a=function(e){$("#"+d.id).remove()};var d=flash.add(PreloaderFlashPath,"flashmoviepreload",a,1,1,"10.0.0",null,{list:b},{allowscriptaccess:"always",menu:"false"},{})}};var isReady=flash.ready;var sendToJavaScript=flash.sendto.js;var sendToActionScript=flash.sendto.as;if(!("console" in window)){var names=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];window.console={};for(var i=0;i<names.length;i++){window.console[names[i]]=function(){}}}$.updateAllDock=function(a){$.updateDock("notifications",a.NotificationsAmount,true);$.updateDock("userpoints",a.UserPoints,true);$.updateDock("housepoints",a.UserPoints,true);$.updateDock("pet",a.PetImage,true);$.updateDock("trunk",a.TrunkItemCount,true)};$.updateDock=function(f,k,j){var c;var d=false;var e=false;switch(f){case"notifications":c="#header-alpha #notification #owl_count_number";d=true;break;case"userpoints":c="#dockHousepoints .points";break;case"housepoints":c="#dockHousepoints .points";break;case"friends":c="#dockFriends .label em";break;case"favourites":c="#dockFavourites .label em";break;case"badges":c="#dockBadges .label em";break;case"trunk":c="#dockTrunk .label em";break;case"pet":c="#dockProfile .avatar img";e=true;break;default:c="";break}if(!e){if(c===""||$(c).length===0){return false}var b=parseInt($(c).text());var g=(j)?k:b+k;var a=(g>999)?g.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):(g<0)?0:g;var h=(d)?(g>99)?"99+":(g<0)?0:g:a;$(c).text(h);if(f==="notifications"){if(h==="0"){$(c).parents("#owl_count").hide()}}}else{$(c).attr("src",k)}};$.redrawCorners=function(){if($.browser.msie&&$.browser.version<9){var a={tl:{radius:3},tr:{radius:3},bl:{radius:3},br:{radius:3},antiAlias:true};var b={tl:{radius:20},tr:{radius:20},bl:{radius:20},br:{radius:20},antiAlias:true};var c={tl:{radius:10},tr:{radius:10},bl:{radius:10},br:{radius:10},antiAlias:true};var d={tl:{radius:5},tr:{radius:5},bl:{radius:5},br:{radius:5},antiAlias:true};if(typeof(curvyCorners)!=="undefined"){if($(".ctabutton a").length>0){curvyCorners(a,".ctabutton a")}if($(".ctabutton").length>0){curvyCorners(a,".ctabutton")}if($(".ctawrap").length>0){curvyCorners(a,".ctawrap")}if($(".board .no-duels").length>0){curvyCorners(d,".board .no-duels")}if($(".board .item").length>0){curvyCorners(d,".board .item")}if($("div.help").length>0){curvyCorners(a,"div.help")}if($(".ctainner").length>0){curvyCorners(a,".ctainner")}if($(".validation-summary-errors").length>0){curvyCorners(a,".validation-summary-errors")}if($("div.help").length>0){curvyCorners(a,".minioverlay .like-panel")}if($(".cell-3 .like-panel").length>0){curvyCorners(a,".cell-3 .like-panel")}if($("#contentHeader .like-panel").length>0){curvyCorners(a,"#contentHeader .like-panel")}if($("#chapter ul").length>0){curvyCorners(b,"#chapter ul")}}}else{return false}};var uim={ie:$.browser.msie?true:false,init:function(a){var d=this;if($(".fanfare").length>0){if($("body").hasClass("B1C1M1")||$("body").hasClass("B1C9M3")){d.multiUIM(a)}else{if($(".fanfare").hasClass("inline")){var c=$(".fanfare").attr("id")+$("#dropdown .username").text();c=c.toLowerCase();if($.cookie(c)=="true"){return false}$.cookie(c,"true",{path:"/"});d.showUIM(a)}}if($("body").hasClass("B2C2M2")||$("body").hasClass("B2C3M3")||$("body").hasClass("B2C4M1")||$("body").hasClass("B2C4M2")&&$("body").hasClass("noCanvasSupport")){return false}else{d.showUIM(a)}a.find(".closebtn").click(function(f){f.preventDefault();d.hideUIM(a)});var b=false;$("#ui-messaging").click(function(f){if(!$(f.target).is("span.ctahighlight")){f.preventDefault();if(!b){d.hideUIM(a)}}});$("#ui-messaging .panel").click(function(f){if(!$(f.target).is("span.ctahighlight")){f.preventDefault();b=true}})}},updateHeading:function(a){var b=a.find("li.active h2").text();a.find("h2:first").text(b);return this},showUIM:function(a){$.LightboxModal.fadeIn(0);a.css("top","0")},hideUIM:function(a){a.css("top","-1000em");$.LightboxModal.fadeOut(500)},multiUIM:function(b){var k=this;$.LightboxModal.fadeIn(0);var a=b.find(".fanfare");a.addClass("multi").find('ul:not(".nav") li:first').addClass("active").siblings().hide();var c=b.find(".closebtn").hide();k.updateHeading(a);var h=a.find('ul:not(".nav") li').length;var g=0;var l=[1];for(var e=0;e<h;e++){var f='<div class="steps step-'+h+'">';for(var d=0;d<h;d++){f+="<a "+(d==e?'class="here" ':"")+'href="#'+d+'">'+a.find('ul:not(".nav") li:eq('+e+") h2").html()+"</a>"}f+="</div>";a.find('ul:not(".nav") li:eq('+e+")").append(f)}a.find("ul.nav a, .steps a").click(function(n){n.preventDefault();if($(this).parent("li").hasClass("next")){g++;if(g>=h){g=0}}else{if($(this).parent("li").hasClass("previous")){g--;if(g<0){g=h-1}}else{g=Number($(this).attr("href").substr(1))}}l[g]=1;var j=0;for(var o=0;o<l.length;o++){if(l[o]==1){j++}}if(j>=h){c.show()}a.find('ul:not(".nav") li:eq('+g+")").show().addClass("active").siblings().hide().removeClass("active");k.updateHeading(a)});k.showUIM(b)}};jQuery.fn.messaging=function(){uim.init($(this))};function webkitDropdownHelper(){if($.browser.webkit){$("input, textarea").live("focusin",function(){$(this).trigger("focus");$(".jsdd-display span").each(function(a){var b=$(this).attr("id");$(document).unbind("keydown");$(this).parents(".jsdd-dropdown").removeClass("focused")})})}}var validate={globalmessages:[],init:function(){if(inlineval.length==0){return false}var a=$("#"+inlineval[0].elementid).parents("form");var b=a.find("input[type='submit']");b.click(function(c){c.preventDefault()})},check:function(c,a,g,f){try{var h=(g!=true)?inlineval:inlinevalajax;if(c.attr("type")!="submit"||h.length==0){return true}var b=c.parents("form")[0];return validate.elements(b,c,a,h,f)}catch(d){return true}},elements:function(c,d,a,n,j){var l=this;var h=n.length;var e=[];while(h--){var g=true;var k=n[h];var b=(k.elementid=="radiogroupname")?$("input[name='username']:first"):$("#"+k.elementid);if(b.length!=0){if(!k.required==false&&l.required(b.val())==false){g=false;l.globalmessages.push(k.required.message)}else{if(!k.isemail==false&&l.isemail(b.val())==false){g=false;l.globalmessages.push(k.isemail.message)}if(!k.maxlength==false&&l.maxlength(b.val(),k.maxlength.len)==false){g=false;l.globalmessages.push(k.maxlength.message)}if(!k.minlength==false&&l.minlength(b.val(),k.minlength.len)==false){g=false;l.globalmessages.push(k.minlength.message)}if(!k.ischecked==false&&l.ischecked(b)==false){g=false;l.globalmessages.push(k.ischecked.message)}if(!k.containsnumeric==false&&l.containsnumeric(b.val())==false){g=false;l.globalmessages.push(k.containsnumeric.message)}if(!k.minandnumeric==false&&l.minandnumeric(b.val(),k.minandnumeric.length)==false){g=false;l.globalmessages.push(k.minandnumeric.message)}if(!k.arethesame==false&&l.arethesame(b.val(),$("#"+k.arethesame.sameas).val())==false){g=false;l.globalmessages.push(k.arethesame.message)}if(!k.radioselected==false&&l.radioselected(b.attr("name"))==false){g=false;l.globalmessages.push(k.radioselected.message)}if(!k.isSameAs==false&&b.val()!=$("#"+k.isSameAs.other).val()){g=false;if(l.globalmessages.indexOf(k.isSameAs.message)==-1){l.globalmessages.push(k.isSameAs.message)}}}if(!k.arethesame==false){b=b.add($("#"+k.arethesame.sameas))}if(g){l.removeerrorstyle(b)}else{l.errorstyle(b)}}}var f=false;if(l.globalmessages.length>0){f=false;l.showerrormessages(c,a,j)}else{f=true;l.hideerrormessages(c)}l.globalmessages=[];return f},submitform:function(a){a.submit()},hideerrormessages:function(a){$(".validation-summary-errors").remove()},showerrormessages:function(b,a,e){var c=(e==true)?b.find(".validation-summary-errors"):$(".validation-summary-errors");if(c.length>0&&$(".validation-summary-errors:first").parents("#imageUpload").length==0){var f=$(".validation-summary-errors");f.find("li").remove()}else{var f=$('<div class="validation-summary-errors"></div>');if(!a==false){a.before(f)}else{b.prepend(f)}f.append("<ul></ul>")}var d=this.globalmessages.length;while(d--){f.find("ul").append("<li>"+this.globalmessages[d]+"</li>")}if(e!=true){b.find(".input-validation-error:first").focus();$("html,body").animate({scrollTop:$(".validation-summary-errors").offset().top-100},500)}},errorstyle:function(a){if(a.is("textarea")){a.addClass("input-validation-error").parents(".group").addClass("error")}else{if(a.attr("type")=="checkbox"){a.addClass("input-validation-error").parents("label").addClass("error")}else{if(a.attr("type")=="radio"){}else{if(a.is("select")){a.addClass("input-validation-error").parents(".handler").addClass("error").find(".jsdd-dropdown .jsdd-display ").addClass("input-validation-error")}else{a.addClass("input-validation-error").parents(".handler").addClass("error")}}}}},removeerrorstyle:function(a){if(a.is("textarea")){a.removeClass("input-validation-error").parents(".group").removeClass("error")}else{if(a.attr("type")=="checkbox"){a.removeClass("input-validation-error").parents("label").removeClass("error")}else{if(a.is("select")){a.removeClass("input-validation-error").parents(".handler").removeClass("error").find(".jsdd-dropdown .jsdd-display ").removeClass("input-validation-error")}else{a.removeClass("input-validation-error").parents(".handler, .group").removeClass("error")}}}},required:function(a){return a.replace(/\s/g,"").length>0},isemail:function(b){var a=/^([0-9a-zA-ZÀ-ÖØ-öø-ÿ_]+)([\.\+\-\'][0-9a-zA-ZÀ-ÖØ-öø-ÿ_]+)*@([a-zA-Z0-9]+)([\.\-][a-zA-Z0-9]+)*(\.[a-zA-Z]{2,})$/;return a.test(b)},maxlength:function(b,a){return b.length<=a},minlength:function(b,a){return b.length>=a},ischecked:function(a){return a.is(":checked")},containsnumeric:function(b){var a=/[0-9]/;return a.test(b)},minandnumeric:function(c,a){var b=(this.containsnumeric(c)==false||this.minlength(c,a)==false)?false:true;return b},arethesame:function(b,a){return b==a},radioselected:function(a){return !$("input[name='"+a+"']:checked").val()==false}};var miniUserProfile={global:{timeout:null,timeToWait:1000,popUpVisible:false,popUpTimeout:null,item:"a.userprofile",hrefSplitter:"profile/",userPopoutData:{}},init:function(){var a=this;if($(a.global.item).length>0){$(".activity-feed ul li.item").each(function(){$(this).find("div a.userprofile:first").addClass("assocAvatar")});$(".sendgift a").live("click",function(b){$(".profilepopup").hide()});$(a.global.item).each(function(){var b=$(this);b.data("load","false")});$(a.global.item+":not('.assocAvatar')").live("mouseover pseudoover",a.over).live("mouseout pseudoout",a.leave);$(a.global.item+".assocAvatar").live("mouseover",a.assocAvatarOver).live("mouseout",a.assocAvatarLeave).unbind("mouseover pseudoover",a.over).unbind("mouseover pseudoover",a.leave)}return a},enter:function(){},leave:function(b){var a=$(this);if($(b.relatedTarget).parents(".avatar").length>0){return false}a.data("load","false");spinner.killSpinner();$("#miniloader").remove();$(this).data("spinning","false")},assocAvatarLeave:function(){$($(this).data("element")).trigger("pseudoout")},over:function(b){var a=$(this);if(a.data("load")=="true"){return false}a.data("load","true");miniUserProfile.addLoadingIcon(a).loadProfile(a)},assocAvatarOver:function(){var b=$(this);if(!b.data("element")){var c=b.attr("href").toLowerCase();var a=b.parents("li").find("a.avatar").filter(function(d){return c===$(this).attr("href").toLowerCase()});b.data("element",a)}$(b.data("element")).trigger("pseudoover")},loadProfile:function(c){var f=this;var a=c;var g=f.global.timeToWait;var d=new Date();clearTimeout(f.global.timeout);a.bind("mouseout",function(k){if($(k.relatedTarget).parents(".avatar").length>0){return false}clearTimeout(f.global.timeout)});var b=a.attr("href");var j=b.split(f.global.hrefSplitter);var h="";if(j.length){h=(j[1].replace(/\//g,"")).toLowerCase()}if(h.length>0){if(f.global.userPopoutData[h]){if(f.global.userPopoutData[h].markup=="loading"){return false}var e=f.getPos(a,h);f.global.userPopoutData[h].popup=f.global.userPopoutData[h].popup||$({});f.global.userPopoutData[h].popup.css({top:e.t,left:e.l,display:"block",visibility:"hidden"});f.global.timeout=setTimeout(function(){f.loadSuccess(h,a,c)},g)}else{f.global.timeout=setTimeout(function(){f.global.userPopoutData[h]={};f.global.userPopoutData[h].markup="loading";$.ajax({type:"GET",url:b,success:function(k){f.global.userPopoutData[h].markup=k;var l=new Date();var n=parseInt(l.getTime())-parseInt(d.getTime());if(n>g){f.loadSuccess(h,a,c)}else{f.global.timeout=setTimeout(function(){f.loadSuccess(h,a,c)},g-n)}},error:f.loadFail,dataType:"html"})},g)}}else{f.loadFail()}return f},loadSuccess:function(p,l,f){var o=this;var d=l;var h=o.global.userPopoutData[p].markup;o.global.userPopoutData[p].className=$(h).find(".houseName").text().toLowerCase();if($(".userStatus",h).length>0){o.global.userPopoutData[p].className+=" hasStatus"}var n=o.getPos(d,p);var c=$('<div class="profilepopup '+o.global.userPopoutData[p].className+'">'+h+'<div class="foot">&nbsp;</div></div>');c.css({top:n.t,left:n.l});$("body").append(c);$.lazyLoadObj([{objectName:"sendreportstatus",parentName:"miniOverlay",fileName:"miniOverlay",checkElement:".profilepopup .reportstatus"}]);var b=c.find(".challengeMe");var g=($(f).parents(".viewport").length>0||b.hasClass("isFriend"))?true:false;if(!g){b.remove()}o.global.userPopoutData[p].popup=c;var a="";if(d.hasClass("hasAssocLink")){var k=d.attr("href");a=d.parents("li:first").find("a.assocAvatar[href='"+k.toLowerCase()+"']");d.data("element",a)}if(d.data("load")=="true"){d.addClass("assocData").data("show","true")}else{d.addClass("assocData").data("show","false")}c.data("show","false");o.popUpEvents(d,c,a);try{$miniloader.remove()}catch(j){}return o},getPos:function(a,e){var d=this;var c={t:0,l:0};if(a.hasClass("avatar")||a.parents().hasClass("avatar")){d.global.userPopoutData[e].className+=" noarrow";c.t=a.find("img").offset().top+"px";if(a.parents("#friends").length>0){d.global.userPopoutData[e].className+=" opposite";var b=176;if(d.global.userPopoutData[e].className.indexOf("hasStatus")>-1){b=401}c.l=a.find("img").offset().left-b+"px"}else{c.l=a.find("img").offset().left+"px"}}else{c.t=a.offset().top-10+"px";c.l=a.offset().left+a.width()+20+"px"}return c},popUpEvents:function(b,c,a){var d=this;d.showPopUp(b,c,true);if(a!==""){a.bind("mouseenter",function(){b.trigger("mouseenter")}).bind("mouseleave",function(){b.trigger("mouseleave")})}b.bind("mouseenter",function(){b.data("show","true");c.data("show","false");d.showPopUp(b,c)}).bind("mouseleave",function(){b.data("show","false");d.showPopUp(b,c)});c.bind("mouseenter",function(){c.data("show","true");b.data("show","false");d.showPopUp(b,c)}).bind("mouseleave",function(){c.data("show","false");d.showPopUp(b,c)})},showPopUp:function(b,c,a){var d=this;clearTimeout(d.global.popUpTimeout);if(b.data("show")=="true"||c.data("show")=="true"){if(a){c.show();clearTimeout(d.global.popUpTimeout);d.global.popUpVisible=true}else{if(!d.global.popUpVisible){d.global.popUpTimeout=setTimeout(function(){clearTimeout(d.global.popUpTimeout);if(b.data("show")=="true"||c.data("show")=="true"){c.show();d.global.popUpVisible=true}},d.global.timeToWait)}}}else{setTimeout(function(){if(b.data("show")=="false"&&c.data("show")=="false"){clearTimeout(d.global.popUpTimeout);c.hide();d.global.popUpVisible=false}},10)}},loadFail:function(){return false},addLoadingIcon:function(a){var b=this;if(a.data("spinning")=="true"){return false}a.data("spinning","true");var c=[];if(a.parent().hasClass("avatar")){c[0]=a;c[1]=parseInt(a.find("img").css("margin-top"))+4;c[2]=parseInt(a.find("img").css("margin-left"))+5}else{if(a.hasClass("avatar")){c[0]=a;c[1]=a.find("img").position().top+4;c[2]=a.find("img").position().left+5}else{$miniloader=$('<div id="miniloader"><span>&nbsp;</span></div>');$("body").append($miniloader);$miniloader.css({top:a.offset().top-10+"px",left:a.offset().left+a.width()+20+"px"});a.bind("mouseout",function(){$miniloader.remove()});c[0]=$miniloader;c[1]=6;c[2]=5}}spinner.init({elem:c[0],top:c[1],left:c[2]});return b}};$.fn.doubleTap=function(a){if(!$.browser.touchdevice){$(this).dblclick(function(f){f.preventDefault();a.call(this,f)})}else{var d=null;var b=0;var c=false;$(this).bind("touchstart.doubleTap",function(f){c=false}).bind("touchmove.doubleTap",function(f){if(f.originalEvent.changedTouches.length>1){c=true}}).bind("touchend.doubleTap",function(g){var h=new Date().getTime();b++;var f=h-d;d=h;if(b==2){previousTouch=null;if(f>=0&&f<500){if(c==false){a.call(this,g)}b=0}else{b=1}}})}};$.fn.singleTap=function(a){if(!$.browser.touchdevice){$(this).click(function(b){b.preventDefault();a.call(this,b)})}else{$(this).bind("touchstart",function(b){b.preventDefault();a.call(this,b)})}};$.fn.hoverTap=function(a){if(!$.browser.touchdevice){$(this).mouseover(function(b){b.preventDefault();a.call(this,b)})}else{$(this).bind("touchstart",function(b){b.preventDefault();a.call(this,b)})}};var badgeNotification=function(a){this.tray=$(a);this.speed="1000";this.visibleFor="8000";this.closeButton=this.tray.children("#close")};badgeNotification.prototype={init:function(b,a){if($(this.tray).length>0){this.initialState();this.trackFooter();this.anim(b,a)}},initialState:function(){$(this.tray).hide();$(this.tray).css({right:"0"})},anim:function(a,b){$(window).scroll();this.trackFooter();$(this.tray).delay("1000").slideDown(a).delay(b).slideUp(a)},manClose:function(a){$(this.tray).stop()},trackFooter:function(){var a=$("#nav-moments"),b=0;if(a.length>0){var c;if($("#footer.stick").length>0){c=$(".storynav.clone").offset().top}else{c=$(a).offset().top}b=$(window).height()-c-36}$(this.tray).css({bottom:b+"px"})}};var BrowserAddOnMessages=function(b){var a=$("body");$("#closePanel").click(function(j){j.preventDefault();$(b).fadeOut(1000)});var f=a.hasClass("explore");var d=$("#section").hasClass("canvas");var e=$.browser.ipad||$.browser.iphone;var c=(typeof swfobject!="undefined")?swfobject.hasFlashPlayerVersion("10.0.0"):false;var g="";var h=false;if(f){if(d&&!_is_canvas_supported){g="canvas";if($.cookie("shownCanvasMessage")!=="shown"){h=true;$.cookie("shownCanvasMessage","shown",{path:"/"})}}else{if(!d&&!c){if(e){g="iOS";if($.cookie("shownIOSMessage")!=="shown"){h=true;$.cookie("shownIOSMessage","shown",{path:"/"})}}else{g="noflash";if($.cookie("shownFlashMessage")!=="shown"){h=true;$.cookie("shownFlashMessage","shown",{path:"/"})}}}}}else{if(a.hasClass("wizards-duel")){if(!_is_canvas_supported){g="canvas";h=true}}else{if(a.hasClass("potion-game")){if(!_is_canvas_supported){g="canvas";h=true}}}}if(h&&g!==""){this.show(b,g)}};BrowserAddOnMessages.prototype.show=function(a,b){$(a).show().css("marginTop","0").find("#"+b).show()};var cookieOverlay=function(){this.speed="2000";this.tray=$("#cookieOverlay");this.help=$(".helpContinue");this.cookie=false;this.button=this.tray.find(".continue");this.learnMore=this.tray.find("p a");this.helpContinue=$("body").find(".helpContinue a");this.noCookies=$("body").find(".noCookies a");this.expiresIn=7300};cookieOverlay.prototype={init:function(){this.cookie=this.hasCookie();if(this.cookie){if($.cookie("repriseMedia")!="decline"){this.insertRMediaCookie()}if($.cookie("repriseMedia")=="accept"){this.setCookie()}}else{if(this.tray.length>0){this.anim()}$.cookie("repriseMedia","seen",{path:"/"})}},anim:function(){this.tray.delay("500").slideDown(this.speed)},buttonContinue:function(b,a){var c=$("#header");if($(a).parent().hasClass("first")){if(c.hasClass("logged")){_gaq.push(["_trackEvent","loggedin","Click","first cookies"])}else{_gaq.push(["_trackEvent","loggedout","Click","first cookies"])}}else{if($(a).parent().hasClass("second")){if(c.hasClass("logged")){_gaq.push(["_trackEvent","loggedin","Click","second cookies"])}else{_gaq.push(["_trackEvent","loggedout","Click","second cookies"])}}else{if(c.hasClass("logged")){_gaq.push(["_trackEvent","loggedin","Click","Continue"])}else{_gaq.push(["_trackEvent","loggedout","Click","Continue"])}}}if(this.tray.length>0){this.tray.slideUp(this.speed)}this.setCookie()},setCookie:function(){$.cookie("repriseMedia","accept",{expires:this.expiresIn,path:"/"})},hasCookie:function(){if($.cookie("repriseMedia")==null){return false}else{return true}},insertRMediaCookie:function(){if($.cookie("repriseMedia")=="accept"||$.cookie("repriseMedia")=="seen"){if(!$.browser.safari){var a=document.createElement("script");a.type="text/javascript";a.src="https://d21j20wsoewvjq.cloudfront.net/tt-df624e54f08e9ca88d402f876326048ffe376e0ec3718c1edc5eada25883565d.js";document.body.appendChild(a)}}},learnMoreClick:function(){var a=$("#header");if(a.hasClass("logged")){_gaq.push(["_trackEvent","loggedin","Click","Findmore"])}else{_gaq.push(["_trackEvent","loggedout","Click","Findmore"])}window.location.href=this.learnMore.attr("href")},noThanks:function(){var a=$("#header");if(a.hasClass("logged")){_gaq.push(["_trackEvent","loggedin","Click","no cookies"])}else{_gaq.push(["_trackEvent","loggedout","Click","no cookies"])}$.cookie("repriseMedia","decline",{expires:7,path:"/"})}};stickyNav=function(){};stickyNav.prototype.init=function(c){var a=this;this.elem=$(c);if(!this.elem.children().length){this.child=$(".activeNav")}else{this.child=this.elem.children();this.child.addClass("activeNav")}if($("#map").length){this.child.addClass("bottom");return false}this.elemHeight=0;this.status=null;this.animateSpeed=150;if(this.child.attr("id")=="momentNavigator"){this.elemHeight=223}if(this.child.attr("id")=="navigationSection"){this.elemHeight=96}this.tabletLimit=(this.child.attr("id")=="momentNavigator")?(564+this.elemHeight):0;this.elem.css("height",this.elemHeight);this.elem.children().css("height",this.elemHeight);a.absoluteOffset=$("#dock-alpha").offset().left;if($.browser.touchdevice){var h,j,f,b,e=(new Date()).getTime(),g=false;$(window).scroll(function(){var k=(new Date()).getTime();if(k-e>400&&!g){$(this).trigger("scrollStart");e=k}clearTimeout(h);h=setTimeout(function(){if(g){$(window).trigger("scrollEnd")}},300)});var d;$(window).bind("scrollStart",function(k){g=true;if(typeof m!=="undefined"&&!m.director.paused){m.director.reset()}d=setInterval(function(){a.update(window.scrollY)},200)}).bind("scrollEnd",function(){g=false;if(typeof m!=="undefined"&&!m.director.paused){m.director.setActive(true)}a.update(window.scrollY);clearInterval(d)})}else{$(window).bind("scroll",function(){a.update(window.scrollY);if(typeof onb!=="undefined"){onb.resize()}})}$(window).resize(function(){a.absoluteOffset=$("#dock-alpha").offset().left;a.width=$("#dock-alpha").width()-($("#aside li").length?150:0);a.child.css({width:a.width});a.update(window.scrollY)});$(window).bind("orientationchange",function(){setTimeout(function(){a.absoluteOffset=$("#main, #body").offset().left;a.width=$("#dock-alpha").width()-($("#aside li").length?150:0);a.child.css({width:a.width});a.update(window.scrollY)},500)});a.width=$("#dock-alpha").width()-($("#aside li").length?150:0);a.child.css({width:a.width});a.update(window.scrollY)};stickyNav.prototype.start=function(){if($("#map").length){return false}var a=this;if(a.elem==null&&a.timeout==undefined){a.timeout=setTimeout(function(){a.start()},500)}else{clearTimeout(a.timeout);a.elem.addClass("ready")}this.footerpos=$("#site-footer").offset().top;a.absoluteOffset=$("#dock-alpha").offset().left;a.update(window.scrollY)};stickyNav.prototype.update=function(b){var a=this;if(b===undefined){b=$(window).scrollTop()}if($("#map").length){return false}a.child.css("left",a.absoluteOffset);if($(window).height()+b<=this.tabletLimit&&(a.status!==1||a.status!==4)){a.child.attr("style","");a.child.css({left:a.absoluteOffset,width:a.width,opacity:1});a.child.addClass("top").removeClass("bottom");if($("#nav-moments #momentNavigator").length){$("body").append(a.child)}a.status=1}else{if($(window).height()+b>=this.footerpos&&(a.status!==3||a.status!==4)){a.status=3;a.child.attr("style","");a.child.css({width:a.width});if(a.elem.parent().width()-($("#aside li").length?150:0)>a.width){a.child.css({left:a.absoluteOffset})}a.child.addClass("bottom").removeClass("top");if(!$("#nav-moments #momentNavigator").length){$("#nav-moments").prepend(a.child)}}else{if(a.status!==2&&(a.status!==4)){a.status=2;a.child.attr("style","");a.child.css({left:a.absoluteOffset,width:a.width});a.child.removeClass("top bottom");if(!$("#nav-moments #momentNavigator").length){$("#nav-moments").prepend(a.child)}}else{a.status=4}}}};var dock={init:function(){this.labelToPlaceholder();this.toggle();this.languageSelector()},checkSignInState:function(a){if($("#dockConfig-toggle").find(".validation-summary-errors").length>0){dock.errorState=true}else{if(location.search&&location.search.split("?")[1].split("=")[0]=="returnPath"){dock.redirectState=true}else{dock.errorState=false}}},labelToPlaceholder:function(){this.checkSignInState();$("#dockConfig-toggle .labelHide").each(function(){var d=$(this);var a=d.find("input");var c=d.find("label");c.hide();var b=$("<input>").attr({type:"text",id:a.attr("id")+"-clone",name:a.attr("name"),tabIndex:a.attr("tabindex")});b.addClass(a.attr("class"));b.val(c.text());a.parent().append(b);if(dock.errorState||a.attr("value").length>0){b.hide()}else{a.hide()}b.bind("focus",function(){b.hide();a.show().focus()});a.bind("blur",function(){if(a.attr("value").length==0){a.hide();b.show()}})})},toggle:function(){var a=this;$("#dock-alpha .toggle").each(function(){var c=$(this);if(c.attr("id")=="dockConfig-toggle"){a.checkSignInState(c)}else{dock.errorState=false}var d=c.parents("li");var e=d.find("a:first");if(!(dock.errorState||dock.redirectState)){c.hide()}else{d.addClass("active");$("body").bind("click.bodyNavHide, touchstart.bodyNavHide",b)}e.bind("click",function(f){f.preventDefault();if(d.hasClass("active")){c.fadeOut(200,function(){d.toggleClass("active")});$("body").unbind("click.bodyNavHide, touchstart.bodyNavHide")}else{c.fadeIn(200,function(){d.toggleClass("active");$("body").bind("click.bodyNavHide, touchstart.bodyNavHide",b)})}});if($("#header-alpha").hasClass("signed-in")){c.bind("mouseleave",function(f){d.removeClass("active");f.preventDefault();c.fadeOut(200);$("body").unbind("click.bodyNavHide")})}function b(f){if(!$(f.target).parents("#"+d.attr("id")).length>0){if(d.hasClass("active")){c.fadeOut(200);$("body").unbind("click.bodyNavHide, touchstart.bodyNavHide");d.toggleClass("active")}}}})},languageSelector:function(){var a=$("#dockLanguage");a.find("label").click(function(){});a.find("input[type=radio]").change(function(){a.find("form").submit()})}};var sampleMomentCounter=0;var _pollLoop;var theDelay;var seenMsgBefore=false;var discoveredDelay=false;var onboarding=function(){this.init()};onboarding.prototype.init=function(){var a=this;var c=obObj.length;var d=[];var b=[];$.each(obObj,function(f,e){if(typeof e!=="undefined"){if(e.id.indexOf("_Desktop")>0&&$.browser.touchdevice){obObj[f]=null;$("#"+e.id).remove()}if((e.id.indexOf("_Touch")>0)&&!$.browser.touchdevice){obObj[f]=null;$("#"+e.id).remove()}if($.inArray(e.id,b)>0){if($("#"+e.id).length==1){}else{}}b.push(e.id.replace("_Desktop","").replace("_Touch",""))}});this.bindEvents();if($("#sample-moment-bg").length>0){_pollLoop=setTimeout(function(){a.pollTotalInteractions()},3000)}};onboarding.prototype.bindEvents=function(){var j=obObj.length;var a=this;this.batchPostback=[];while(j--){if(obObj[j]!=null){switch(obObj[j].trigger){case ("Initial"):this.OBHandler_Initial(obObj[j].id);break;case ("InitialWithParallelMessage"):this.OBHandler_InitialWithParallelMessage(obObj[j].id);break;case ("OpenShoppingList"):$("#I15057_3").css({left:"50%",top:300,"margin-left":-150,"z-index":1000});$("#shoppingListYear1").bind("click touchend",function(){a.postOnboardingActivity("I15057_3");a.showMessage("I15057_3",undefined,function(){})});$("#I15057_3,  #shopping-list-frame").bind("click touchend",function(){if($("#I15057_3")){a.hideMessage("I15057_3",undefined,false)}});break;case ("VisitShop"):var g=obObj[j].id;$("#"+g).css({left:"50%",top:300,"margin-left":-150,"z-index":1000});this.batchPostback.push(g);this.showMessage(g,undefined,function(){$("#page").bind("click touchend",function(){a.hideMessage(g,undefined,false)})});break;case ("BuyAPet"):this.OBHandler_BuyAPet(obObj[j].id);break;case ("BuyAWand"):this.OBHandler_BuyAWand(obObj[j].id);break;case ("ShownWelcomeMessage"):this.OBHandler_CommonRoomWelcomeMsg(obObj[j].id);break;case ("AfterSelectHarrysJourney"):break;case ("OnSelectBookIcon"):this.OBHandler_Initial(obObj[j].id);break;case ("SelectStorylineNavigator"):break;case ("OnVisitMomentWithMultipleLayers"):this.OBHandler_OnVisitMomentWithMultipleLayers(obObj[j].id);break;case ("MomentHasCollectable"):this.OBHandler_VisitsMomentWithCollectable(obObj[j].id);break;case ("VisitsMomentWithDiscoverable"):this.OBHandler_VisitsMomentWithDiscoverable(obObj[j].id);break;case ("CollectsFirstCollectable"):var d=obObj[j].id;a.OBHandler_CollectsFirstCollectable(d);break;case ("CollectsCandle"):this.OBHandler_CollectsSampleCandle(obObj[j].id);break;case ("FirstTriggersInteraction"):this.OBHandler_FirstTriggersInteraction(obObj[j].id);break;case ("FirstTriggersInteractionSample"):this.OBHandler_FirstTriggersInteractionSample(obObj[j].id);break;case ("UnlocksFirstDiscoverable"):var e=obObj[j].id;this.hideVisibleMessages(function(){a.OBHandler_UnlocksFirstDiscoverable(e)});break;case ("UnlocksFirstDiscoverableSample"):var f=obObj[j].id;this.hideVisibleMessages(function(){a.OBHandler_UnlocksFirstDiscoverableSample(f)});break;case ("CollectsGalleonSample"):var b=obObj[j].id;this.hideVisibleMessages(function(){a.OBHandler_CollectsGalleonSample(b)});break;case ("CollectsHairpin"):var c=obObj[j].id;this.hideVisibleMessages(function(){a.OBHandler_CollectsHairpin(c)});break;case ("FirstMovesLayer"):var h=obObj[j].id;this.hideVisibleMessages(function(){a.OBHandler_MovesFirstLayer(h)});break}}}if(a.batchPostback.length){a.postOnboardingActivity(a.batchPostback)}};onboarding.prototype.hideVisibleMessages=function(b){var a=this;var c=$(".onboarding-msg:visible:not(.hasArrow)").fadeOut(1000,function(){if(typeof b!=="undefined"){b.call()}});if(!$(".onboarding-msg:visible:not(.hasArrow)").length){setTimeout(function(){if(typeof b!=="undefined"){b.call()}},1000)}};onboarding.prototype.discoverCountDown=function(){var a=this;clearTimeout(theDelay);if(!discoveredDelay){theDelay=setTimeout(function(){if(!seenMsgBefore){a.hideVisibleMessages();a.queueAndShowMessage("I19959_5",undefined,function(){$("#mainContent, #experience, #recommendationsPanel").bind("click",function(){a.hideMessage("I19959_5");seenMsgBefore=true;clearTimeout(theDelay)})})}},20000)}};onboarding.prototype.pollTotalInteractions=function(){var a=this;if(sampleMomentCounter>=8){clearTimeout(_pollLoop);setTimeout(function(){a.queueAndShowMessage("I19959_8")},5000);$("#mainContent, #experience, #recommendationsPanel").bind("click touchend",function(){a.hideMessage("I19959_8",undefined,false)})}else{_pollLoop=setTimeout(function(){a.pollTotalInteractions()},3000)}};onboarding.prototype.queue=[];onboarding.prototype.queueAndShowMessage=function(b){var a=this;if(typeof b!=="undefined"){this.queue.push(b)}if(this.queue.length==1){setTimeout(function(){$("#experience").append($("#"+b));a.showMessage(b)},1000);$("#moments li, #"+b+", #experience, #recommendationsPanel").bind("click touchend",function(){a.hideMessage(b,undefined,false);a.queue.pop()})}else{var c=this.queue.length;setTimeout(function(){a.hideVisibleMessages();setTimeout(function(){$("#experience").append($("#"+a.queue[c-1]));a.showMessage(a.queue[c-1]);setTimeout(function(){a.hideMessage(a.queue[c-1],undefined,false);a.queue.pop()},4000);$("#moments li, #"+a.queue[c-1]+", #experience, #recommendationsPanel").bind("click touchend",function(){a.hideMessage(a.queue[c-1],undefined,false);a.queue.pop()})},500)},4000*(c-1)+1000)}};onboarding.prototype.showMessage=function(l,j,k){var b=$("#"+l);if(typeof j!=="undefined"&&j!==null){if($(j.selector).length==0){return false}if(typeof j.offset==="undefined"){j.offset={left:0,top:0}}var c=$(j.selector);var o={left:0,top:0};var h={left:0,top:0};if(b.find(".ob-arrow").length==0){var a=$("<div class='ob-arrow'></div>");b.addClass("hasArrow");b.find(".content-inner").append(a)}else{var a=b.find(".ob-arrow")}if(b.parent().offset()==null){var n={left:0,top:0}}else{var n={left:b.parent().offset().left,top:b.parent().offset().top}}this.browserPrefix=($.browser.mozilla)?"-moz-":($.browser.chrome||($.browser.safari))?"-webkit-":"";var f;var e=15;var g=new Object;g[this.browserPrefix+"transition-duration"]="0.6s";g[this.browserPrefix+"transition-timing-function"]="cubic-bezier(1,1,1,1)";returnObj=new Object;returnObj[this.browserPrefix+"transition-duration"]="0.3s";returnObj[this.browserPrefix+"transform"]="translate3d(0px, 0px, 0px)";switch(j.dir){case (0):h.left=(b.width()-a.width())/2;h.top=-70;o.left=c.offset().left;o.top=c.offset().top;o.left+=c.width()/2-a.width()/2-(b.width()-a.width())/2+n.left+j.offset.left;o.top+=-(n.top-86-c.height())+j.offset.top;b.css(o);a.addClass("up").css(h);g[this.browserPrefix+"transform"]="translate3d(0px, -"+e+"px, 0px)";break;case (1):h.left=b.width()-10;h.top=-66;o=c.offset();o.left+=-a.width()-b.width()+n.left+20+j.offset.left;o.top+=-n.top+70+c.height()+j.offset.top;b.css(o);a.addClass("up-right").css(h);g[this.browserPrefix+"transform"]="translate3d("+e+"px, -"+e+"px, 0px)";break;case (2):h.left=b.width()+26;h.top=(b.height()-a.height())/2;o=c.offset();o.left+=-b.width()+n.left-96+j.offset.left;o.top+=c.height()/2-a.height()/2-(b.height()-a.height())/2-n.top+j.offset.top;b.css(o);a.addClass("right").css(h);g[this.browserPrefix+"transform"]="translate3d("+e+"px, 0px, 0px)";break;case (3):h.left=b.width();h.top=b.height();o=c.offset();o.left+=-b.width()+n.left-60+j.offset.left;o.top+=-b.height()-a.height()-n.top+j.offset.top;b.css(o);a.addClass("down-right").css(h);g[this.browserPrefix+"transform"]="translate3d("+e+"px, "+e+"px, 0px)";break;case (4):h.left=(b.width()-a.width())/2;h.top=b.height()+10;o=c.offset();o.left+=(c.width()-a.width())/2-(b.width()-a.width())/2+n.left+j.offset.left;o.top+=-n.top-b.height()-a.height()-20+j.offset.top;b.css(o);a.addClass("down").css(h);g[this.browserPrefix+"transform"]="translate3d(0px, "+e+"px, 0px)";break;case (5):h.left=-a.width()+7;h.top=b.height()-4;o=c.offset();o.left+=a.width()+c.width()+n.left-10+j.offset.left;o.top+=-n.top-b.height()-a.height()+j.offset.top;b.css(o);a.addClass("down-left").css(h);g[this.browserPrefix+"transform"]="translate3d(-"+e+"px, "+e+"px, 0px)";break;case (6):h.left=-a.width()-10;h.top=(b.height()-a.height())/2;o=c.offset();o.left+=a.width()+c.width()+n.left+20+j.offset.left;o.top+=-b.height()/2-n.top+c.height()/2+j.offset.top;b.css(o);a.addClass("left").css(h);g[this.browserPrefix+"transform"]="translate3d(-"+e+"px, 0px, 0px)";break;case (7):h.left=-a.width()+5;h.top=-a.height()+5;o=c.offset();o.left+=a.width()+c.width()+n.left+j.offset.left;o.top+=b.height()/2+a.height()-n.top+j.offset.top;b.css(o);a.addClass("up-left").css(h);g[this.browserPrefix+"transform"]="translate3d(0px, -"+e+"px, 0px)";break}b.attr("data-elem",j.selector);b.attr("data-top-offset",o.top-c.offset().top);b.attr("data-left-offset",o.left-c.offset().left)}var d=this;$(window).scroll(function(p){d.onScroll(p)});$(window).resize(function(p){d.onResize(p)});$("#"+l).fadeIn(1000,function(){if(typeof k!=="undefined"){k.call()}if(typeof a!=="undefined"){var p=true;a.css(g).bind("oTransitionEnd transitionend webkitTransitionEnd",function(){if(p){a.css(returnObj)}else{setTimeout(function(){a.css(g)},300)}p=!p})}})};onboarding.prototype.onScroll=function(a){if($("#onboarding .onboarding-msg:visible").length==0){return false}$.each($("#onboarding .onboarding-msg:visible"),function(c,b){if(typeof $(this).attr("data-elem")!=="undefined"){$(this).css("top",parseInt($(b).attr("data-top-offset"))+$($(b).attr("data-elem")).offset().top)}})};onboarding.prototype.onResize=function(){if($("#onboarding .onboarding-msg:visible").length==0){return false}$.each($("#onboarding .onboarding-msg:visible"),function(b,a){if(typeof $(this).attr("data-elem")!=="undefined"){$(this).css("top",parseInt($(a).attr("data-top-offset"))+$($(a).attr("data-elem")).offset().top);$(this).css("left",parseInt($(a).attr("data-left-offset"))+$($(a).attr("data-elem")).offset().left)}})};onboarding.prototype.deviceType=($.browser.touchdevice)?"_Touch":"_Desktop";onboarding.prototype.hideMessage=function(b,a,c){if(c!=false||typeof c==="undefined"){this.postOnboardingActivity(b)}$("#"+b).fadeOut(500,function(){if(typeof a!=="undefined"){a.call()}})};onboarding.prototype.postOnboardingActivity=function(c,b){var a=this;if($("#signinform").length<1){$.ajax({type:"POST",url:"/api/"+global.VARS.lang+"/progress/userviewedonboardingmessage/?identifier="+c,data:{},success:function(d){if(typeof b!=="undefined"){b.call()}},error:function(d,f){}})}};onboarding.prototype.OBHandler_MovesFirstLayer=function(b){var a=this;var d=false;switch(b){case ("I15044_2"+a.deviceType):if($(".layer:not([data-prog-ignore])").length>1){$("#container").doubleTap(function(){if(!d){d=true;$("#experience").append($("#I15044_2"+a.deviceType));a.queueAndShowMessage("I15044_2"+a.deviceType);setTimeout(function(){a.postOnboardingActivity("I15044_2")},500);$("#midlayer, #recommendationsPanel").bind("click touchend",function(){a.hideMessage(b,undefined,false)})}})}break;case ("I19959_2"+a.deviceType):function c(){if(!d){d=true;sampleMomentCounter=sampleMomentCounter+1;a.queueAndShowMessage("I19959_2"+a.deviceType);$("#midlayer, #recommendationsPanel").bind("click touchend",function(){a.hideMessage(b,undefined,false)});$("#I19959_1"+a.deviceType).hide();$("#I19959_2"+a.deviceType).fadeIn()}}$("#container").doubleTap(function(){c()});$(document).keydown(function(f){switch(f.keyCode){case 38:case 40:f.preventDefault();c();break}});break}};onboarding.prototype.OBHandler_CollectsFirstCollectable=function(c){var a=this;var b=false;$("#obj .trunk").bind("click touchend",function(){if(!b){b=true;a.postOnboardingActivity(c)}})};onboarding.prototype.OBHandler_UnlocksFirstDiscoverable=function(c){var a=this;var b=false;$("#container .item.discoverable").bind("click",function(){if(!b){b=true;a.postOnboardingActivity(c)}})};onboarding.prototype.OBHandler_CollectsHairpin=function(c){var b=this;var a=$("#"+c);$("#obj dt.hairpin + dd").find(".trunk").bind("click touchend",function(){$("#experience").append(a);b.queueAndShowMessage(c)})};onboarding.prototype.OBHandler_CollectsSampleCandle=function(b){var a=this;$(".items a").bind("touchend click",function(){var c=$(this).attr("id");if(c=="candle"){a.queueAndShowMessage("I19959_4")}});$("#midlayer, #recommendationsPanel").dblclick(function(){a.hideMessage("I19959_4",undefined,false)})};onboarding.prototype.OBHandler_FirstTriggersInteractionSample=function(b){var a=this;var c=false;$("#desk-owl-trigger, #window-owl-feathers-trigger, #quill-trigger, #paper-trigger").bind("touchstart mouseover",function(){if(!c){a.discoverCountDown();a.queueAndShowMessage("I19959_3");c=true}});$("#midlayer, #recommendationsPanel").bind("click touchend",function(){a.hideMessage(b,undefined,false)});$("#rearlayer, #recommendationsPanel").bind("click touchend",function(){a.hideMessage(b,undefined,false)})};onboarding.prototype.OBHandler_CollectsGalleonSample=function(b){var a=this;$(".items a").live("touchend click",function(){a.discoverCountDown();var c=$(this).attr("id");if(c=="galleon-collect"){a.queueAndShowMessage("I19959_7")}});$("#rearlayer, #recommendationsPanel").bind("click touchend",function(){a.hideMessage("I19959_7",undefined,false)})};onboarding.prototype.OBHandler_UnlocksFirstDiscoverableSample=function(c){var a=this;var b=false;$(".discovermebtn input").bind("click",function(){if(!b){clearTimeout(theDelay);b=true;discoveredDelay=true;sampleMomentCounter=sampleMomentCounter+1;a.queueAndShowMessage(c)}});$("#midlayer, #recommendationsPanel").bind("click touchend",function(){a.hideMessage(c,undefined,false)})};onboarding.prototype.OBHandler_CommonRoomWelcomeMsg=function(b){var a=this;if(b=="I15060_1"){a.postOnboardingActivity("I15060_1");a.showMessage(b,{selector:"#common-room",dir:4,offset:{left:0,top:10}});$("#main").bind("click touchend",function(){a.hideMessage(b,undefined,false)})}};onboarding.prototype.OBHandler_BuyAWand=function(c){var a=this;var b=false;if(c=="I15057_11"){a.showMessage("I15057_11");a.postOnboardingActivity("I15057_11");a.showMessage(c,{selector:"#magical-menagerie",dir:4,offset:{left:0,top:10}});var b=false}};onboarding.prototype.OBHandler_BuyAPet=function(c){var a=this;var b=false;if(c=="I15055_1"){$("#productCard input").bind("click touchend",function(){a.showMessage("I15055_1",{selector:"#great-hall",dir:4,offset:{left:0,top:10}},function(){$("#page").bind("click touchend",function(){a.hideMessage(c)})});a.postOnboardingActivity("I15055_1");var d=true})}else{if(c=="I15057_8"){$("#productCard input").bind("click touchend",function(){var d=function(){$(document).unbind("ajaxComplete",d);$.ajax({url:"/action/profile/mapnavigation",}).done(function(e){$("#navigationSection").html(e);a.showMessage(c,{selector:"#ollivanders",dir:4,offset:{left:0,top:10}});a.postOnboardingActivity("I15057_8")})};$(document).ajaxComplete(d)})}}};onboarding.prototype.OBHandler_VisitsMomentWithDiscoverable=function(b){var a=this;if(b=="I15044_4"){a.showMessage(b,{selector:"#momentThumb"+MOMENT_ID.toUpperCase()+" .icons.jkr",dir:4,offset:{left:0,top:0}});this.batchPostback.push(b);$("#moments li, #"+b+", #experience, #recommendationsPanel").bind("click touchend",function(){a.hideMessage(b,undefined,false)})}else{if($("#container .item.discoverable").length){this.batchPostback.push(b)}}};onboarding.prototype.OBHandler_VisitsMomentWithCollectable=function(b){var a=this;if(b=="I15044_3"&&$(".items a[title='Collect']").length){a.queueAndShowMessage(b);this.batchPostback.push(b)}else{if($(".items a[title='Collect']").length){this.batchPostback.push(b)}}};onboarding.prototype.OBHandler_OnVisitMomentWithMultipleLayers=function(b){var a=this;if($("#container > .layer:not([data-prog-ignore])").length>1){a.batchPostback.push(b)}};onboarding.prototype.OBHandler_InitialWithParallelMessage=function(b){var a=this;switch(b){case ("I15041_2H"):$("#map").append($("#"+b).css({bottom:26,left:32,top:"auto"}));this.batchPostback.push(b);$("#"+b+" .page-button").bind("click touchend",function(){a.postOnboardingActivity("I15041_2HButton");a.hideMessage(b,function(){a.showMessage("I19919_1"+a.deviceType,{selector:"#books #b2 img",dir:4,offset:{left:0,top:0}},function(){$("#books a img").bind("click touchend",function(){var d="bookId"+$(this).parent().attr("id").split("b")[1];var e=$(this).parent().attr("id").split("b")[1];if(e<4){var c=this;a.hideMessage("I19919_1"+a.deviceType,function(){if($(c).parent().attr("id").split("b")[1]>3&&$("#I19923_1"+a.deviceType+":isVisible")){return false}a.showMessage("I19923_1"+a.deviceType,{selector:"#momentNavigator",dir:4,offset:{left:0,top:30}});$("#experience").bind("click touchstart",function(){a.hideMessage("I19923_1"+a.deviceType)})})}})})},false)});$("#nav-moments").bind("click touchend",function(c){a.postOnboardingActivity("I15041_2HButton");if(!$(c.target).parent().parent().hasClass("bookIcon")){a.hideMessage(b,undefined,true)}});break;case ("I15041_2Y"):if(!$.browser.android){$("#aside").append($("#"+b).css({top:386,right:181,left:"auto"}))}else{if($.browser.android){$("#aside").append($("#"+b).css({top:370,right:181,left:"auto"}))}}this.batchPostback.push(b);$("#"+b+" .page-button").bind("click",function(){a.postOnboardingActivity("I15041_2YButton");a.hideMessage(b,function(){a.showMessage("I15041_3",{selector:"#gringotts",dir:4});a.postOnboardingActivity("I15041_3")},false)});break}this.showMessage(b)};onboarding.prototype.OBHandler_Initial=function(b){var a=this;switch(b){case ("I15042_1"+a.deviceType):this.showMessage(b,{selector:"#logo",dir:0});$("#moments li, #"+b+", #experience, #recommendationsPanel").bind("click touchend",function(){a.hideMessage(b,function(){a.showMessage("I19975_1"+a.deviceType,{selector:"#books #b2 img",dir:4,offset:{left:0,top:0}},function(){$("#books a img").bind("click",function(){var d="bookId"+$(this).parent().attr("id").split("b")[1];var d="bookId"+$(this).parent().attr("id").split("b")[1];var e=$(this).parent().attr("id").split("b")[1];if(e<4){a.hideMessage("I19975_1"+a.deviceType,function(){$("#I19975_1"+a.deviceType).remove();a.showMessage("I19975_2"+a.deviceType,{selector:"#momentNavigator",dir:4,offset:{left:0,top:20}})})}});$("#experience, #nav-moments").bind("click touchend",function(){a.hideMessage("I19975_1"+a.deviceType)})})})});break;case ("I19975_2"+a.deviceType):break;case ("I19975_3"+a.deviceType):this.batchPostback.push(b);setTimeout(function(){a.showMessage(b,{selector:"#"+$(".isNext").attr("id"),dir:4,offset:{left:10,top:10}});$(".isNext").bind("click",function(){a.hideMessage(b);$(this).unbind("click")});$("#experience, #nav-moments").bind("click touchend",function(){a.hideMessage("I19975_3"+a.deviceType)})},1500);break;case ("I19975_4"+a.deviceType):this.batchPostback.push("I19975_4");a.showMessage(b,{selector:"#"+$(".isNext").attr("id"),dir:4,offset:{left:0,top:30}});$("#nav-moments, #"+b+", #experience, #recommendationsPanel").bind("click touchend",function(){a.hideMessage(b,undefined,false)});break;case ("I19975_5"+a.deviceType):this.batchPostback.push(b);setTimeout(function(){a.showMessage(b,{selector:"#"+$("#momentThumb"+MOMENT_ID.toUpperCase()).next().attr("id"),dir:4,offset:{left:0,top:30}})},1000);$("#nav-moments, #"+b+", #experience, #recommendationsPanel").bind("click touchend",function(){a.hideMessage(b,undefined,false)});break;case ("I19923_1"+a.deviceType):$("#books a img").bind("click touchend",function(){if($("#I15041_2H:visible").length){a.hideMessage("I15041_2H",undefined,false);a.postOnboardingActivity("I15041_2HButton")}var d="bookId"+$(this).parent().attr("id").split("b")[1];var e=$(this).parent().attr("id").split("b")[1];if(e<4){a.hideMessage(b,function(){a.showMessage(b,{selector:"#momentNavigator",dir:4,offset:{left:0,top:30}})})}else{a.hideMessage(b,undefined,false)}});$("#nav-moments").bind("click touchend",function(d){a.postOnboardingActivity("I15041_2HButton");if(!$(d.target).parent().parent().hasClass("bookIcon")){a.hideMessage(b,undefined,true)}});break;case ("I19923_2"+a.deviceType):this.batchPostback.push(b);setTimeout(function(){a.showMessage(b,{selector:"#"+$(".isNext").attr("id"),dir:4,offset:{left:0,top:5}});$(".isNext, li.bookIcon a").bind("click",function(){a.hideMessage(b);$(this).unbind("click")})},1500);break;case ("I19923_3"+a.deviceType):a.batchPostback.push(b);setTimeout(function(){a.showMessage(b,{selector:"#"+$(".isNext").attr("id"),dir:4,offset:{left:0,top:15}});$("#nav-moments").bind("click",function(){$(this).unbind("click")})},500);break;case ("I19923_4"+a.deviceType):this.batchPostback.push(b);this.queueAndShowMessage(b);break;case ("I15057_1"):a.showMessage(b,{selector:"#diagon-alley",dir:4,offset:{left:0,top:30}},function(){$("#diagon-alley").bind("click",function(){a.hideMessage("I15057_1")})});break;case ("I15057_2"+a.deviceType):this.batchPostback.push(b);var c=function(){$(document).unbind("ajaxComplete",c);$.ajax({url:"/action/profile/mapnavigation",}).done(function(d){$("#navigationSection").html(d);a.showMessage(b,{selector:"#shoppingListYear1",dir:0,offset:{left:0,top:-10}},function(){$("#shoppingListYear1").bind("click touchend",function(){a.hideMessage("I15057_2"+a.deviceType,undefined,false)})})})};$(document).ajaxComplete(c);break;case ("I15057_10"):a.showMessage(b,{selector:"#great-hall",dir:4,offset:{left:0,top:10}});$("#page").bind("click touchend",function(){a.hideMessage(b)});break;case ("I15055_1"):a.showMessage(b,{selector:"#great-hall",dir:4,offset:{left:0,top:10}});$("#page").bind("click touchend",function(){a.hideMessage(b)});break;case ("I15058_1"):a.showMessage("I15058_1",{selector:"#unopen .key img",dir:6},function(){var d=false;$(".key").bind("click touchend",function(){d=gringotts.panelOpen;var e=function(){$(document).unbind("ajaxComplete",e);$.ajax({url:"/action/profile/mapnavigation",}).done(function(f){$("#navigationSection").html(f)})};$(document).ajaxComplete(e);if(d==true){a.hideMessage("I15058_1");a.showMessage("I15058_2"+a.deviceType,{selector:"#logo",dir:0},false)}})});break;case ("I15044_1"+a.deviceType):if($(".layer:not([data-prog-ignore])").length>1){this.queueAndShowMessage(b);this.batchPostback.push(b)}$("#moments li, #"+b+", #experience, #recommendationsPanel").bind("click touchend",function(){a.hideMessage(b,undefined,false)});break;case ("I15057_4"):this.showMessage(b,{selector:"#diagon-alley",dir:4,offset:{left:0,top:10}});break;case ("I15057_6"):this.showMessage(b,{selector:"#magical-menagerie",dir:4,offset:{left:0,top:10}});break;case ("I15057_7"):$("#"+b).css({left:"50%",top:300,"margin-left":-150,"z-index":1000});this.showMessage("id",undefined,function(){$("#page").bind("click touchend",function(){a.hideMessage(b)})});break;case ("I15057_9"):this.showMessage(b,{selector:"#ollivanders",dir:4,offset:{left:0,top:10}});break;case ("I15055_2"):this.showMessage(b,{selector:"#great-hall",dir:0,offset:{left:0,top:-10}});break;case ("I15057_8"):this.showMessage(b,{selector:"#navigationSection #ollivanders",dir:4,offset:{left:0,top:10}});$("#page").bind("click touchend",function(){a.hideMessage(b)});break;case ("I15060_2"):$("#"+b).css({left:"50%",top:200,"margin-left":-150,"z-index":1000});a.postOnboardingActivity(b);this.showMessage(b,undefined,function(){$("#page").bind("click touchend",function(){a.hideMessage(b)})});break;case ("I15057_5"):break;case ("I15041_3"):if(!$("#I15041_2Y").length){this.batchPostback.push(b);this.showMessage(b,{selector:"#gringotts",dir:4,offset:{left:0,top:10}})}break;default:break}};MomentIntro=function(){this.init()};MomentIntro.prototype.autoDur=3000;MomentIntro.prototype.fadeDur=1000;MomentIntro.prototype.element=$("#momentNew-overlay");MomentIntro.prototype.bookMark=$("#intro-bookmark");MomentIntro.prototype.bookMarkPos=$("#intro-bookmark").offset();MomentIntro.prototype.bookMarkPlaceHolder=$("#bookmark-placeholder");MomentIntro.prototype.bookMarkPlaceHolderPos=$("#bookmark-placeholder").offset();MomentIntro.prototype.autoLoadExceptions=[];MomentIntro.prototype.callback=function(){};MomentIntro.prototype.init=function(){var a=this;this.useTransform=($.browser.IE)?false:true;if(this.setAutoLoad()){this.timeout=setTimeout(function(){a.hide()},this.autoDur)}this.bookMarkPos=$("#intro-bookmark").offset();this.bindEvents()};MomentIntro.prototype.setAutoLoad=function(){this.autoLoad=true;if($.browser.android){return false}var a=this.autoLoadExceptions.length;while(a--){if(MOMENT_ID===this.autoLoadExceptions){this.autoLoad=false}}return this.autoLoad};MomentIntro.prototype.hide=function(b){var a=this;$("#experience,#canvas").unbind("click.intro touchend.intro");loadingImg.stop(loadingAnim);if(this.useTransform){this.bookMark.css({top:-1-this.bookMarkPos.top+this.bookMarkPlaceHolderPos.top,left:17-this.bookMarkPos.left+this.bookMarkPlaceHolderPos.left})}else{this.bookMark.animate({top:-1-this.bookMarkPos.top+this.bookMarkPlaceHolderPos.top,left:17-this.bookMarkPos.left+this.bookMarkPlaceHolderPos.left},1000)}setTimeout(function(){if(a.useTransform){$(a.bookMarkPlaceHolder).addClass("docked");$(a.element).addClass("introClosed")}else{$(a.element).animate({opacity:0},1000,function(){$(a.bookMarkPlaceHolder).addClass("docked");$(a.element).addClass("introClosed")})}setTimeout(function(){$(a.element).css("display","none");if(typeof b!=="undefined"){b.call()}a.callback()},a.fadeDur)},this.fadeDur)};MomentIntro.prototype.show=function(){var a=this;$(a.element).css("display","block").fadeTo(1000,1,function(){$(a.element).removeClass("introClosed").attr("style","");a.bookMarkPlaceHolderPos=$(a.bookMarkPlaceHolder).offset();if(a.useTransform){a.bookMark.css({top:-1,left:17}).bind("webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd",function(){a.bookMarkPos=a.bookMark.offset()})}else{a.bookMark.animate({top:-1,left:17},1000,function(){a.bookMarkPos=a.bookMark.offset()})}$(a.bookMarkPlaceHolder).removeClass("docked");a.clickExperience()})};MomentIntro.prototype.bindEvents=function(){var a=this;this.clickExperience();this.clickBookMark();this.hoverIntro()};MomentIntro.prototype.hoverIntro=function(b){if(this.autoLoad===false){return false}var a=this;$("#momentNew-overlay .standard").bind("mouseover touchend",function(){clearTimeout(a.timeout)})};MomentIntro.prototype.clickExperience=function(){var a=this;$("#experience,#canvas").bind("click.intro touchend.intro",function(b){clearTimeout(a.timeout);a.hide()})};MomentIntro.prototype.clickBookMark=function(b){var a=this;$(a.bookMarkPlaceHolder).bind("click touchend",function(){if(!$(this).hasClass("docked")){return false}a.show()})};$(document).ready(function(){$("a[href$='#commentFormWrapper']").bind("touchstart click",function(h){h.preventDefault();if($(".comingNext").length){$("#experience").animate({scrollTop:1400},1000)}else{$("html,body").animate({scrollTop:550},1000)}});var d=true;var e=true;$("#shoppingListYear1").bind("click",function(h){h.preventDefault();$(".firstYearShoppingList").toggleClass("show");$("#shoppingListYear1").toggleClass("slActive");if(d){$(".firstYearShoppingList").css("display","block");d=false}else{if($(".firstYearShoppingList").css("display")=="none"){$(".firstYearShoppingList").css("display","block")}else{$(".firstYearShoppingList").css("display","none")}}if($(".secondYearShoppingList").hasClass("show")){$(".secondYearShoppingList").toggleClass("show");$("#shoppingListYear2").removeClass("slActive")}$(".secondYearShoppingList").hide()});$("#shoppingListYear2").bind("click",function(){$(".secondYearShoppingList").toggleClass("show");$("#shoppingListYear2").toggleClass("slActive");if(e){$(".secondYearShoppingList").css("display","block");e=false}else{if($(".secondYearShoppingList").css("display")=="none"){$(".secondYearShoppingList").css("display","block")}else{$(".secondYearShoppingList").css("display","none")}}if($(".firstYearShoppingList").hasClass("show")){$(".firstYearShoppingList").toggleClass("show");$("#shoppingListYear1").removeClass("slActive")}$(".firstYearShoppingList").hide()});var b=false;$(".proclose").bind("touchstart click",function(h){h.preventDefault();$(".firstYearShoppingList").css("display","none");$("#shoppingListYear1").removeClass("slActive");$(".secondYearShoppingList").css("display","none");$("#shoppingListYear2").removeClass("slActive");if(!b){b=true;if($("#I15057_5").length&&$("#I15057_5_shown").length==0){$("#I15057_5").css({left:"20%",top:480,"margin-left":241,"z-index":1000});onboarding.showMessage("I15057_5",{selector:"#pets",dir:2,offset:{left:-200,top:10}},function(){$("#page").bind("click touchend",function(){onboarding.hideMessage("I15057_5")})});if($("#I15057_5").length){onboarding.hideMessage("I15057_3",function(){$("#I15057_3").remove()},false)}}}});if($(".spoiler").length>0){$(".spoiler").each(function(){$(this).spoiler()})}$.browser.chrome=($.browser.webkit&&/chrome/.test(navigator.userAgent.toLowerCase()))?true:false;$.browser.safari=($.browser.webkit&&!$.browser.chrome&&/safari/.test(navigator.userAgent.toLowerCase()))?true:false;$.browser.ipad=($.browser.safari&&/ipad/.test(navigator.userAgent.toLowerCase()))?true:false;$.browser.iphone=($.browser.safari&&/iphone/.test(navigator.userAgent.toLowerCase()))?true:false;$.browser.android=(/android/.test(navigator.userAgent.toLowerCase()))?true:false;$.browser.touchdevice=$.browser.ipad||$.browser.iphone||$.browser.android;if($("body").hasClass("B2C12M3")){$("#atmos").hide()}if($("#floodlight").length>0){$("#floodlight").floodLoadImg()}if($(".storynav").length>0&&!$.browser.touchdevice){$(".storynav").stickyFooter()}if($.browser.touchdevice){$(".navi .txt").remove()}if($.browser.touchdevice){$(":input").focus(function(){$("#mapFooterNav").hide()});$(":input").blur(function(){$("#mapFooterNav").show()})}if($("#Comment").length>0){$("#Comment").commenting()}if($(".sendfeedback").length>0){$(".sendfeedback").showFeedback()}$("#about").singleTap(function(){$(this).toggleClass("hovered")});$("#signs .menu .icon").singleTap(function(){});if($.browser.touchdevice){$("#footholder .info").hide();$("#badgeList .badge span").bind("touchstart",function(){$("#badgeList .badge span.hovered").removeClass("hovered");$(this).addClass("hovered")})}$(".section").initJPlayer();$("body").addClass("js").removeClass("basic");$('a[rel="external"]').attr("target","_blank");global.initAjaxDefaults().init();frames.init();components.init();analytics.events();dock.init();if($("#ui-messaging").length>0){$("#ui-messaging").messaging()}miniUserProfile.init();$.lazyLoadObj([{objectName:"form",autoRun:true},{objectName:"sendreport",parentName:"miniOverlay",fileName:"miniOverlay",checkElement:"#activity .activity-feed, #comments .activity-feed, .reporter"},{objectName:"sendreportuser",parentName:"miniOverlay",fileName:"miniOverlay",checkElement:".reportuser"},{objectName:"sendreportstatus",parentName:"miniOverlay",fileName:"miniOverlay",checkElement:".reportstatus"},{objectName:"sendgift",parentName:"miniOverlay",fileName:"miniOverlay",checkElement:".userprofile, .potions, .trunk"},{objectName:"gethowto",parentName:"miniOverlay",fileName:"miniOverlay",checkElement:"a.howto, span.howto a"},{objectName:"showgallery",parentName:"miniOverlay",fileName:"miniOverlay",checkElement:".illustrations .more-link,.illustrations .show-more-link a"},{objectName:"imgoverlaygallery",parentName:"miniOverlay",fileName:"miniOverlay",checkElement:"#body .img-wrapper"},{objectName:"imgoverlaygallery",parentName:"miniOverlay",fileName:"miniOverlay",checkElement:".notifications .illustration-approved a"},{objectName:"subComponents",autoRun:true}]);$("#invite-button").live("click",function(h){h.preventDefault();FB.ui({method:"apprequests",message:"Have you heard about Pottermore? Go to www.pottermore.com to sign up today!",data:"invite-to-momentum",filters:["app_non_users"]})});$(".addFr input[type='submit']").live("click",function(k){k.preventDefault();spinner.init({elem:$(this).parents(".user:first").find("dd.av:last .avatar"),top:10,left:9});var h=$(this).parents("form:first");var l=h.attr("action");var j=h.serialize();$.ajax({type:"POST",url:l,data:j,success:function(o){var n=h.parent();h.replaceWith(o);spinner.killSpinner();$(".nicklabel").hide()}})});if($("#no-flash .sub h3").length>0){$("#no-flash .sub h3").click(function(h){$(this).toggleClass("toggled").next("p").toggle()})}$(".ctabutton.input").live("focusin",function(){$(this).find(".ctawrap").hide()});$(".ctabutton.input").live("focusout",function(){$(this).find(".ctawrap").show()});webkitDropdownHelper();var g=new badgeNotification("#notificationsoverlay");if(g.tray.length>0){g.init(g.speed,g.visibleFor);$(g.closeButton).click(function(h){h.preventDefault();g.manClose(g.speed)});$(window).resize(function(){g.trackFooter()});$(window).scroll(function(){g.trackFooter()})}var a=new BrowserAddOnMessages("#systemMsg");$.redrawCorners();var c=new cookieOverlay();c.init();if(c){$(c.button).singleTap(function(h){c.buttonContinue(h,this);c.insertRMediaCookie();h.preventDefault()});$(c.learnMore).singleTap(function(){c.learnMoreClick()})}if(c.helpContinue){$(c.helpContinue).singleTap(function(h){c.buttonContinue(h,this);c.insertRMediaCookie();window.location.href=$(this).attr("href")});$(c.noCookies).singleTap(function(h){c.noThanks();window.location.href=$(this).attr("href")})}$(".info-helper").live("focus",function(){var h=$(this);var j=false;if(h.find("a").length==0){return false}h.addClass("focused").find("a").focus(function(){j=true}).focusout(function(){j=false;h.removeClass("focused")});h.focusout(function(){setTimeout(function(){if(!j){h.removeClass("focused")}},50)})});if($(".register form .row").length>0){$.focusFirstField()}$("#dockConfig a").click(function(){if($("#dockUserConfig").hasClass("opened")){$("#dockUserConfig").removeClass("opened");$("#dockUserConfig").addClass("closed")}else{$("#dockUserConfig").removeClass("closed");$("#dockUserConfig").addClass("opened")}});if($("#navigationSection,#nav-moments").length>0){stickyN=new stickyNav;stickyN.init($("#nav-moments"));stickyN.start()}if($("#homeCarousel").length>0){}if($(".newfromjkr").length>0){var f=1;$(".meta-chapter p").each(function(){if(f==1){$(this).addClass("capital");f++}})}});window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1000/60)}})();window.requestTimeout=function(b,a){if(!window.requestAnimationFrame&&!window.webkitRequestAnimationFrame&&!window.mozRequestAnimationFrame&&!window.oRequestAnimationFrame&&!window.msRequestAnimationFrame){return window.setTimeout(b,a)}var e=new Date().getTime(),c=new Object();function d(){var f=new Date().getTime(),g=f-e;g>=a?b.call():c.value=requestAnimFrame(d)}c.value=requestAnimFrame(d);return c};window.clearRequestTimeout=function(a){window.cancelAnimationFrame?window.cancelAnimationFrame(a.value):window.webkitCancelRequestAnimationFrame?window.webkitCancelRequestAnimationFrame(a.value):window.mozCancelRequestAnimationFrame?window.mozCancelRequestAnimationFrame(a.value):window.oCancelRequestAnimationFrame?window.oCancelRequestAnimationFrame(a.value):window.msCancelRequestAnimationFrame?msCancelRequestAnimationFrame(a.value):clearTimeout(a)};window.requestInterval=function(b,a){if(!window.requestAnimationFrame&&!window.webkitRequestAnimationFrame&&!window.mozRequestAnimationFrame&&!window.oRequestAnimationFrame&&!window.msRequestAnimationFrame){return window.setInterval(b,a)}var e=new Date().getTime(),c=new Object();function d(){var f=new Date().getTime(),g=f-e;if(g>=a){b.call();e=new Date().getTime()}c.value=requestAnimFrame(d)}c.value=requestAnimFrame(d);return c};window.clearRequestInterval=function(a){window.cancelAnimationFrame?window.cancelAnimationFrame(a.value):window.webkitCancelRequestAnimationFrame?window.webkitCancelRequestAnimationFrame(a.value):window.mozCancelRequestAnimationFrame?window.mozCancelRequestAnimationFrame(a.value):window.oCancelRequestAnimationFrame?window.oCancelRequestAnimationFrame(a.value):window.msCancelRequestAnimationFrame?msCancelRequestAnimationFrame(a.value):clearInterval(a)};$(".comingNext img").bind("contextmenu",function(a){return false});