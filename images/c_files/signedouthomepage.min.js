(function(){var a=0;var b=["webkit","moz"];for(var c=0;c<b.length&&!window.requestAnimationFrame;++c){window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(d,f){var e=new Date().getTime();var h=Math.max(0,16-(e-a));var g=window.setTimeout(function(){d(e+h)},h);a=e+h;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());$(function(){$.ajaxSetup({error:function(b,a){if(b.status===0){}else{if(b.status==404){}else{if(b.status==500){}else{if(a==="parsererror"){}else{if(a==="timeout"){}else{if(a==="abort"){}else{}}}}}}}})});var rotationSpeed=parseInt(appSettings.RotateHomePageBackgroundSpeed)*1000;rotationSpeed=rotationSpeed;var JSON=JSON||{};var rotateBGCounter=0;var rotateBGLoop=0;var bgArray=new Array();var firstbgImg;var plugins=new Array();var carousel;$(function(){var a;try{backgroundChanger.initBGImgs()}catch(b){}try{SampleContent.showContent()}catch(b){}if(typeof sessionStorage.hasNavProgress!=="undefined"){sessionStorage.clear()}carousel=new Carousel();carousel.init();repositionOverlay()});var pageWidth=($("#mainContent").width()-$("#recommendationsPanel").width());function repositionOverlay(){try{var c=($("#mainContent").height()-$("#homeCarousel").height());var b=$(".signedout-page-overlay").height();if($(window).width()>$("#mainContent").width()){pageWidth=($("#mainContent").width()-$("#recommendationsPanel").width())}else{if($(window).width()==1024){pageWidth=874}else{pageWidth=$(window).width()-$("#recommendationsPanel").width()}}}catch(a){}if($("#pottermoretoday-overlay-wrap").length>0){$("#pottermoretoday-overlay-wrap").css("position","absolute").css("left",(pageWidth/2)).css("margin-left",($("#pottermoretoday-overlay-wrap").width()/2*-1));if($.browser.touchdevice){$("#pottermoretoday-overlay-wrap").css("position","absolute").css("left",(pageWidth/2)-50).css("margin-left",($("#pottermoretoday-overlay-wrap").width()/2*-1))}}else{$.each($(".signedout-page-overlay"),function(e,d){$(d).css("top",c/2-$(d).height()/2)})}}var Carousel=function(){};Carousel.prototype.init=function(){var a=this;$("#homeCarousel").removeClass("nojs");this.crsSize=$("#carouselScroll li").outerWidth()*$("#carouselScroll li").length;this.crsItemSize=$("#carouselScroll li").outerWidth();this.crsItems=$("#carouselScroll ul li");this.startGap=$(".scrollPrevious").width();this.crsLength=$("#carouselScroll li").length;this.totalWidth=this.crsLength*this.crsItemSize;this.carousel=$("#carouselScroll ul");this.crsMousedown=false;this.crsDirection;this.speed=700;this.selectedItem;this.animating=false;this.mainContentSelector="#main";this.carouselLinkSelector=".carouselLink";this.obj=new Object();this.browserPrefix=($.browser.mozilla)?"-moz-":($.browser.chrome||($.browser.safari))?"-webkit-":"";this.useTransform=($.browser.IE)?false:true;$("#carouselScroll").width(this.crsSize*5);var b=$("#carouselScroll ul li").clone().addClass("pre");var c=$("#carouselScroll ul li").clone().addClass("post");b.clone().insertBefore("#carouselScroll ul li:first-child");b.clone().insertBefore("#carouselScroll ul li:first-child");c.clone().addClass("post").insertAfter("#carouselScroll ul li:last-child");c.clone().addClass("post").insertAfter("#carouselScroll ul li:last-child");this.activeClass=$("#wrapper").attr("class")+"-crs";$("."+this.activeClass).addClass("active");$("#carouselScroll ul li").each(function(d,e){var f=d*a.crsItemSize;$(e).attr("data-offset",f)});this.thumbOffset=new Array(),this.classSet=new Array();this.resizeCarousel().repositionCarousel().addDesktopEvents();this.addTouchEvents()};Carousel.prototype.resizeCarousel=function(){$("#carouselWrap").css("max-width",parseInt($("#main").width())-149);return this};Carousel.prototype.repositionCarousel=function(b){var a=this;this.wrapWidth=$("#carouselWrap").outerWidth();this.crsOffsetItems=(this.wrapWidth-this.crsItemSize)/2;this.crsOffset=-$("#carouselScroll ul li.active").not(".pre, .post").attr("data-offset")+this.crsOffsetItems;if(b){this.animateOffset(this.crsOffset)}else{this.changeOffset(this.crsOffset)}return this};Carousel.prototype.changeOffset=function(a){if(this.useTransform){this.obj[this.browserPrefix+"transition-duration"]="0s";this.obj[this.browserPrefix+"transition-timing-function"]="linear";this.obj[this.browserPrefix+"transform"]="translate3d("+a+"px, 0px, 0px)";$(this.carousel).css(this.obj)}else{$(this.carousel).css("left",a)}this.currentOffset=a};Carousel.prototype.animateOffset=function(f,d,e,c,b){var a=this;if(this.useTransform){this.obj[this.browserPrefix+"transition-duration"]=d+"s";this.obj[this.browserPrefix+"transition-timing-function"]="ease-out";this.obj[this.browserPrefix+"transform"]="translate3d("+f+"px, 0px, 0px)";$(this.carousel).css(this.obj).bind("oTransitionEnd transitionend webkitTransitionEnd",function(){a.currentOffset=f;if(e){a.changeOffset(a.currentOffset+((c)?a.totalWidth:-a.totalWidth))}if(typeof b==="function"){b.call()}else{if(a.repositionRequired){a.repositionCarousel().resizeCarousel();a.repositionRequired=false}a.animating=false;a.mouseDown=false;a.btnTouchDown=false}$(a.carousel).unbind("oTransitionEnd transitionend webkitTransitionEnd")})}else{d=d*1000;$(this.carousel).animate({left:f},d,function(){a.currentOffset=f;if(e){a.changeOffset(a.currentOffset+((c)?a.totalWidth:-a.totalWidth))}if(typeof b==="function"){b.call()}else{a.animating=false;a.mouseDown=false;a.btnTouchDown=false}a.animating=false})}};Carousel.prototype.addDesktopEvents=function(){var a=this;if($.browser.touchdevice){return false}$(window).bind("resize orientationchange",function(){if(!a.animating){a.resizeCarousel().repositionCarousel()}else{a.repositionRequired=true}});$("#carouselScroll a").bind("click",function(c){c.preventDefault();if(a.animating){return false}a.animating=true;var d=$(c.target).parents("a");var f=$(c.target).parents("li");var g=-parseInt(f.attr("data-offset"))+a.crsOffsetItems;if(g===a.currentOffset&&f.hasClass("active")){a.animating=false;return false}if(g===a.currentOffset){a.load(d)}else{var b=(g-a.currentOffset>0)?false:true;a.animateOffset(g,0.5,f.is(".pre, .post"),b,function(){a.load(d)})}});$("#carouselWrap .scrollNext").bind("mouseup mouseout",function(b){b.preventDefault();if(a.mouseDown){a.mouseDown=false;a.animating=true;var c=a.currentOffset-(a.currentOffset%a.crsItemSize)-a.crsItemSize*2+a.startGap;a.animateOffset(c,a.getDuration(a.currentOffset,c),false,false)}else{if(b.type=="mouseup"){clearTimeout(a.mouseDownTimeout);if(a.animating){return false}a.animating=true;var c=a.currentOffset-a.crsItemSize;a.animateOffset(c,a.getDuration(a.currentOffset,c),a.getThumbAtX(c-a.crsOffsetItems).is(".pre, .post"),true)}}}).mousedown(function(b){a.mouseDownTimeout=setTimeout(function(){a.mouseDown=true;a.mouseDownTimer=Date.now();(function c(){if(a.mouseDown){a.scrollLeft(a.mouseDownTimer-Date.now());a.mouseDownTimer=Date.now();requestAnimationFrame(c)}})()},200)});$("#carouselWrap .scrollPrevious").bind("mouseup mouseout",function(b){b.preventDefault();if(a.mouseDown){a.mouseDown=false;a.animating=true;var c=a.currentOffset-(a.currentOffset%a.crsItemSize)+a.startGap;a.animateOffset(c,a.getDuration(a.currentOffset,c),false,false)}else{if(b.type=="mouseup"){clearTimeout(a.mouseDownTimeout);if(a.animating){return false}a.animating=true;var c=a.currentOffset+a.crsItemSize;a.animateOffset(c,a.getDuration(a.currentOffset,c),a.getThumbAtX(c-a.crsOffsetItems).is(".pre, .post"),false)}}}).mousedown(function(b){a.mouseDownTimeout=setTimeout(function(){a.mouseDown=true;a.mouseDownTimer=Date.now();(function c(){if(a.mouseDown){a.scrollRight(a.mouseDownTimer-Date.now());a.mouseDownTimer=Date.now();requestAnimationFrame(c)}})()},200)});return this};Carousel.prototype.addTouchEvents=function(){var a=this;if(!$.browser.touchdevice){return false}$(window).bind("resize orientationchange",function(){if(!a.animating){a.resizeCarousel().repositionCarousel()}else{a.repositionRequired=true}});$("#carouselScroll ul a").bind("touchend touchstart click",function(b){b.preventDefault()});$("#carouselScroll ul a").bind("click",function(){return false});$("#carouselScroll ul").bind("touchstart",function(b){b.preventDefault();if(a.animating){return false}a.startX=b.originalEvent.touches[0].clientX;a.startOffset=a.currentOffset;a.diff=0}).bind("touchmove",function(b){b.preventDefault();a.touchSpeed=a.startX-b.originalEvent.touches[0].clientX-a.diff;a.diff=a.startX-b.originalEvent.touches[0].clientX;if(Math.abs(a.diff)>50&&!a.touchDown&&!a.animating){a.touchDown=true;a.startX=b.originalEvent.touches[0].clientX}else{if(a.touchDown&&!a.animating){a.newOffset=a.startOffset-a.diff;a.changeOffset(a.newOffset)}}}).bind("touchend",function(c){c.preventDefault();if(!a.touchDown&&!a.animating){a.animating=true;var d=$(c.target).parents("a");var f=$(c.target).parents("li");var g=-parseInt(f.attr("data-offset"))+a.crsOffsetItems;if(g===a.currentOffset&&f.hasClass("active")){a.touchDown=false;a.animating=false;return false}if(g===a.currentOffset){a.load(d)}else{var b=(g-a.currentOffset>0)?false:true;a.animateOffset(g,0.5,f.is(".pre, .post"),b,function(){a.load(d)})}}else{if(a.touchDown){a.animating=true;var h=a.getThumbAtX(-(-a.currentOffset+a.crsOffsetItems+a.touchSpeed*5));var g=-parseInt(h.attr("data-offset"))+a.crsOffsetItems;var b=(a.touchSpeed>0)?true:false;g-=(b)?214:0;a.animateOffset(g,1,h.is(".pre, .post"),b);a.touchDown=false}}});return this};Carousel.prototype.scrollLeft=function(b){var a=this;if(a.currentOffset<-(a.totalWidth*2)){a.currentOffset+=a.totalWidth}a.changeOffset(a.currentOffset+(b*a.speed/1000))};Carousel.prototype.scrollRight=function(b){var a=this;if(a.currentOffset>-a.totalWidth){a.currentOffset-=a.totalWidth}a.changeOffset(a.currentOffset-(b*a.speed/1000))};Carousel.prototype.getDuration=function(c,b){var a=b-c;a=a>0?a:-a;return a/this.speed};Carousel.prototype.getTransformXY=function(a){if(this.useTransform){var e=a.css(this.browserPrefix+"transform");var b=e.replace(/[^0-9\-.,]/g,"").split(",");var c,d;if(e.indexOf("3d")!==-1){c=b[12]*1;d=b[13]*1}else{c=b[4]*1;d=b[5]*1}}else{return{x:a.position().left}}return{x:c,y:d}};Carousel.prototype.getThumbAtX=function(b){var a=-b/this.crsItemSize<<0;return $("#carouselScroll ul li").eq(a)};Carousel.prototype.loadedScripts=[];Carousel.prototype.unbindIg=function(a){ig.system.canvas.removeEventListener("mousedown",ig.mouseDownBound,false);window.removeEventListener("keydown",ig.mouseDownBound,false);ig.system.canvas.removeEventListener("mouseup",ig.mouseUpBound,false);window.removeEventListener("keyup",ig.mouseUpBound,false);ig.system.canvas.removeEventListener("mouseout",ig.mouseMoveOut,false);ig.system.canvas.removeEventListener("mousemove",ig.mouseMoveBound,false);ig.system.canvas.removeEventListener("contextmenu",ig.contextMenuBound,false);window.removeEventListener("contextmenu",ig.contextMenuBound,false);ig.system.stopRunLoop();document.removeEventListener("DOMContentLoaded",ig._DOMReady,false);window.removeEventListener("load",ig._DOMReady,false);$(window).unbind("scroll.box2d resize.box2d");ig._current=null;var c=[];for(var h in ig.modules){var b=false;c.push(h)}for(var e=0,g=c.length;e<g;e++){delete ig.modules[c[e]]}c=[];if(ig.resources.length>0){for(var k in ig.resources){if(b){c.push(k)}}}for(var e=0,g=c.length;e<g;e++){var f=c[e],j=ig.resources[f];if(!j.hasOwnProperty(f)){return}if(isNaN(parseInt(f))||!(j instanceof Array)){delete j[f]}else{j.splice(f,1)}}if(typeof a!=="undefined"){a.call()}};Carousel.prototype.load=function(c){var e=this;var a=$(c);var b=a.data("wrapperclass");var d={url:a.attr("href")};if(typeof ig!=="undefined"&&typeof ig.system!=="undefined"){e.unbindIg()}$("#carouselScroll ul").unbind("touchstart touchend touchmove click oTransitionEnd transitionend webkitTransitionEnd");$("a[href='#poRestart'], a[href='{PractiseLink}']").die("click touchend");$.ajax(d).success(function(f){$("#wrapper").attr("class",b);$(e.mainContentSelector).html(f);var h=$("#scriptsToLoad").html();$("#loader-box").hide();if(h){var g=JSON.parse(h);$(".carouselCSS").remove();$.each(g.css,function(k,j){$.getCSS(j)});e.getScripts(g.scripts)}if($(f).find("#onboarding").length){window.obObj=[];$.each($(f).find("#onboarding .onboarding-msg"),function(k,j){window.obObj[k]={id:$(j).attr("id"),trigger:$(j).attr("data-type"),"arrow-only":$(j).hasClass("arrow-only")}});window.onb=new onboarding()}else{$("#sound-control").remove()}$("#bookmark-overlay[style]").removeAttr("style")}).done(function(){if(_pollLoop&&$("#sample-moment-bg").length==0){clearTimeout(_pollLoop)}$("#carouselScroll .active").removeClass("active");$("."+a.attr("data-wrapperclass")+"-crs").addClass("active");repositionOverlay();if($("a.vid").length>0){$("a.vid").addVideo()}clearInterval(rotateBGLoop);try{bgTemplate=$("#BGImgObject").html();if(bgTemplate){var h=JSON.parse(bgTemplate);bgArray=backgroundChanger.makeBGArray(h)}rotateBGCounter=0;if($("#exploreharrysjourney-overlay").length>0){thebgFile=bgArray[0];var g=$("#dynamic-bg div");g.css("background-image",'url("'+global.VARS.assetroot+"redesign/images/signedout/backgrounds/"+$.trim(thebgFile)+'")')}else{if(bgArray.length!=1){thebgFile=bgArray[0];var g=$("#dynamic-bg div");g.css("background-image",'url("'+global.VARS.assetroot+"redesign/images/signedout/backgrounds/"+$.trim(thebgFile)+'")');if(appSettings.RotateHomePageBackground){rotateBGLoop=0;rotateBGLoop=setInterval(backgroundChanger.changeBG,rotationSpeed)}}else{thebgFile=bgArray[0];var g=$("#dynamic-bg div");g.css("background-image",'url("'+global.VARS.assetroot+"redesign/images/signedout/backgrounds/"+$.trim(thebgFile)+'")')}}}catch(f){}e.addTouchEvents();e.animating=false;e.TouchDown=false}).error(function(g,h,f){})};Carousel.prototype.getScripts=function(b){var a=[];var c=this;$.map(b,function(d){a.push($.getScript(d));c.loadedScripts.push(d)});return $.when($,a,$.Deferred(function(d){$(d.resolve)}))};var SampleContent={showContent:function(){$("#newWriting-link").live("click",function(){$("#newwritingfromjkr-overlay").css("display","none");var a=$("#dynamic-bg div");a.fadeOut(1000,function(){a.css("background-image",'url("'+global.VARS.assetroot+'redesign/images/signedout/backgrounds/what-is-pmore-a.jpg")');a.fadeIn(500);rotateBGCounter=0;clearInterval(rotateBGLoop)});$("#contentSample-primary").css("display","block")})}};var backgroundChanger={changeBG:function(){if((rotateBGCounter!=0)&&rotateBGCounter>bgArray.length-1){rotateBGCounter=0}thebgFile=bgArray[rotateBGCounter];var a=$("#dynamic-bg div");var b=a.css("background-image");var c=/\"|\'|\)/g;if(bgArray.length>0){if(thebgFile==b.split("/").pop().replace(c,"")){if((rotateBGCounter)==bgArray.length){thebgFile=bgArray[0];rotateBGCounter=0}else{counter=parseInt(rotateBGCounter)+1;thebgFile=bgArray[counter];rotateBGCounter=counter}}}if((typeof thebgFile!=="undefined"||window.thebgFile!==undefined)&&bgArray.length!=1){a.show().animate({opacity:0.5},250,function(){a.css("background-image",'url("'+global.VARS.assetroot+"redesign/images/signedout/backgrounds/"+$.trim(thebgFile)+'")');rotateBGCounter++;a.show().animate({opacity:1},250,function(){})})}else{if(firstbgImg!=$.trim(thebgFile)){a.css("background-image",'url("'+global.VARS.assetroot+"redesign/images/signedout/backgrounds/"+$.trim(thebgFile)+'")');rotateBGCounter=0;clearInterval(rotateBGLoop)}}},makeBGArray:function(c){try{var b="";$.each(c,function(e,d){b=d});bgArray=b.toString().split(",");return bgArray}catch(a){}},initBGImgs:function(){var b;$(window).focus(function(){if(!rotateBGLoop&&appSettings.RotateHomePageBackground){rotateBGLoop=setInterval(backgroundChanger.changeBG,rotationSpeed)}});$(window).blur(function(){clearInterval(rotateBGLoop);rotateBGLoop=0});try{bgTemplate=$("#BGImgObject").html();if(bgTemplate){var c=JSON.parse(bgTemplate);bgArray=backgroundChanger.makeBGArray(c)}else{}firstbgImg=bgArray[0];var d=$("#dynamic-bg div");d.css("background-image",'url("'+global.VARS.assetroot+"redesign/images/signedout/backgrounds/"+$.trim(firstbgImg)+'")');if(appSettings.RotateHomePageBackground){if(bgArray.length>1){rotateBGLoop=setInterval(backgroundChanger.changeBG,rotationSpeed)}}}catch(a){}}};$.getCSS=function(b,a){if($("link[href='"+b+"']").length){$("link[href='"+b+"']").remove()}$("<link>").attr({"class":"carouselCSS",href:b,type:"text/css",rel:"stylesheet"}).appendTo("head")};